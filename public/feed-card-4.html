<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Card 4 - New Season Alert</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #ffffff;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
        }

        /* ========================================
           REUSABLE COMPONENT CLASSES
           Use these classes across all card types
           ======================================== */

        /* Glassmorphism Effects */
        .glass-light {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .glass-medium {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
        }

        .glass-heavy {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
        }

        .glass-dark {
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        /* Action Buttons - 40x40px circular */
        .action-btn-base {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .action-btn-primary {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
        }

        .action-btn-primary:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }

        .action-btn-liked {
            background: rgba(255, 59, 92, 0.2);
        }

        /* Icon Buttons - For headers and nav */
        .icon-btn-base {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .icon-btn-glass {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
        }

        .icon-btn-glass:hover {
            background: rgba(255, 255, 255, 0.25);
        }

        /* Typography Utilities */
        .text-title {
            font-size: 16px;
            font-weight: 600;
            line-height: 1.3;
        }

        .text-username {
            font-size: 14px;
            font-weight: 600;
        }

        .text-meta {
            font-size: 13px;
            opacity: 0.7;
        }

        .text-body {
            font-size: 14px;
            line-height: 1.5;
        }

        .text-small {
            font-size: 12px;
        }

        .text-tiny {
            font-size: 11px;
        }

        /* Badge Styles */
        .badge-base {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }

        .badge-glass {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(8px);
        }

        .badge-accent {
            background: rgba(255, 59, 92, 0.2);
            color: #FF3B5C;
        }

        .badge-success {
            background: rgba(52, 211, 153, 0.2);
            color: #34D399;
        }

        /* Avatar Styles */
        .avatar-small {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            border: 2px solid rgba(255, 255, 255, 0.3);
            object-fit: cover;
        }

        .avatar-medium {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border: 2px solid rgba(255, 255, 255, 0.3);
            object-fit: cover;
        }

        .avatar-large {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            border: 2px solid rgba(255, 255, 255, 0.3);
            object-fit: cover;
        }

        /* Overlay Styles */
        .overlay-dark {
            background: linear-gradient(to bottom,
                rgba(0, 0, 0, 0) 0%,
                rgba(0, 0, 0, 0.3) 50%,
                rgba(0, 0, 0, 0.9) 100%
            );
        }

        .overlay-black {
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(8px);
        }

        /* Comment Components */
        .comment-header-base {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 6px;
        }

        .comment-actions-base {
            display: flex;
            gap: 12px;
            margin-top: 6px;
        }

        .comment-like-btn-base {
            display: flex;
            align-items: center;
            gap: 4px;
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.6);
            font-size: 11px;
            font-weight: 600;
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 12px;
            transition: all 0.2s;
        }

        .comment-like-btn-base:hover {
            background: rgba(255, 255, 255, 0.05);
            color: rgba(255, 255, 255, 0.9);
        }

        .comment-like-btn-base.liked {
            color: #FF3B5C;
        }

        /* Layout Utilities */
        .flex-center {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .flex-between {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .flex-gap-sm {
            gap: 8px;
        }

        .flex-gap-md {
            gap: 12px;
        }

        .flex-gap-lg {
            gap: 16px;
        }

        /* Spacing Utilities */
        .p-sm { padding: 8px; }
        .p-md { padding: 12px; }
        .p-lg { padding: 16px; }
        .p-xl { padding: 20px; }

        .mb-sm { margin-bottom: 8px; }
        .mb-md { margin-bottom: 12px; }
        .mb-lg { margin-bottom: 16px; }

        /* Border Radius */
        .rounded-sm { border-radius: 8px; }
        .rounded-md { border-radius: 12px; }
        .rounded-lg { border-radius: 16px; }
        .rounded-full { border-radius: 50%; }

        /* Transitions */
        .transition-base {
            transition: all 0.2s ease;
        }

        .transition-medium {
            transition: all 0.3s ease;
        }

        /* Card container with 3D perspective */
        .card-container {
            width: 398px;
            height: 645px;
            margin: 0 16px;
            perspective: 1000px;
            position: relative;
        }

        /* Card with flip transformation */
        .card {
            width: 100%;
            height: 100%;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 16px;
            touch-action: none;
        }

        .card.flipped {
            transform: rotateY(180deg);
        }

        /* Card faces */
        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            -webkit-backface-visibility: hidden;
            border-radius: 16px;
            overflow: hidden;
        }

        .card-front {
            z-index: 2;
        }

        .card-back {
            transform: rotateY(180deg);
            background: linear-gradient(to bottom, #1a1a1a 0%, #0a0a0a 100%);
            overflow: hidden;
        }

        /* Front card styles (existing design) */
        .card-background {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        .card-background img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .background-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom,
                rgba(0, 0, 0, 0) 0%,
                rgba(0, 0, 0, 0.3) 50%,
                rgba(0, 0, 0, 0.9) 100%
            );
            z-index: 2;
        }

        .card-content {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 20px;
            padding-bottom: 40px;
            z-index: 3;
            color: white;
        }

        /* User header */
        .user-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: 1.5px solid white;
            object-fit: cover;
        }

        .user-info {
            flex: 1;
        }

        .username {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 1px;
        }

        .timestamp {
            font-size: 11px;
            font-weight: 400;
            opacity: 0.7;
        }

        /* Show info */
        .show-title {
            font-size: 16px;
            font-weight: 600;
            line-height: 1.3;
            margin-bottom: 6px;
        }

        .show-meta {
            font-size: 12px;
            font-weight: 400;
            opacity: 0.85;
            margin-bottom: 6px;
        }

        .meta-dot {
            margin: 0 4px;
            opacity: 0.5;
        }

        /* Friend avatars */
        .friend-avatars {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 10px;
        }

        .friend-avatars-stack {
            display: flex;
            margin-right: 6px;
        }

        .friend-avatars-stack img {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            border: 1.5px solid #000;
            margin-left: -6px;
        }

        .friend-avatars-stack img:first-child {
            margin-left: 0;
        }

        .friend-count {
            font-size: 12px;
            font-weight: 400;
            opacity: 0.85;
        }

        /* Menu button (three dots) */
        .menu-btn {
            position: absolute;
            top: 20px;
            right: 12px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(60, 60, 60, 0.4);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1.5px solid rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 6;
            transition: all 0.2s;
        }

        .menu-btn:active {
            transform: scale(0.9);
        }

        .menu-btn svg {
            width: 20px;
            height: 20px;
        }

        /* Side actions */
        .side-actions {
            position: absolute;
            right: 12px;
            bottom: 60px;
            z-index: 4;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .action-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(60, 60, 60, 0.4);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1.5px solid rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .action-btn:active {
            transform: scale(0.9);
        }

        .action-btn svg {
            width: 24px;
            height: 24px;
            stroke: white;
            fill: none;
            stroke-width: 1.5;
        }

        .action-btn.liked svg {
            fill: #FF3B5C;
            stroke: #FF3B5C;
        }

        .action-count {
            text-align: center;
            font-size: 12px;
            font-weight: 600;
            margin-top: 2px;
            color: white;
        }

        /* Back of card styles */
        .card-back-content {
            padding: 20px 16px;
            padding-top: 50px;
            padding-bottom: 20px;
            /* Use absolute positioning to fill card-back */
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            width: 100%;
            /* Enable scrolling - content will overflow */
            overflow-y: scroll;
            overflow-x: hidden;
            /* Critical for iOS momentum scrolling - MUST be present */
            -webkit-overflow-scrolling: touch !important;
            overscroll-behavior: contain;
            overscroll-behavior-y: contain;
            touch-action: pan-y;
            -webkit-tap-highlight-color: transparent;
            z-index: 1;
        }

        /* Title Section */
        .back-title-section {
            margin-bottom: 16px;
        }

        .back-title {
            font-size: 22px;
            font-weight: 700;
            margin-bottom: 6px;
            letter-spacing: -0.5px;
        }

        .back-meta {
            display: flex;
            align-items: center;
            gap: 8px;
            flex-wrap: wrap;
            margin-bottom: 12px;
        }

        .back-year {
            font-size: 14px;
            opacity: 0.9;
        }

        .back-rating {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            font-size: 14px;
            font-weight: 600;
        }

        .meta-dot {
            opacity: 0.5;
        }

        /* Badge Pills */
        .back-badges {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
            margin-bottom: 14px;
        }

        .back-badge {
            padding: 8px 14px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            text-align: center;
            min-width: 36px;
        }

        /* Synopsis */
        .back-synopsis {
            font-size: 14px;
            line-height: 1.5;
            opacity: 0.9;
            margin-bottom: 8px;
        }

        .back-synopsis.collapsed {
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .read-more {
            color: #FF006E;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            margin-bottom: 16px;
            display: block;
            text-align: right;
        }

        /* Action Icons */
        .back-action-icons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .back-icon-btn {
            width: 42px;
            height: 42px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.2s ease;
            color: white;
        }

        .back-icon-btn:active {
            transform: scale(0.9);
        }

        .back-icon-btn.primary {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        /* Info Grid */
        .back-info-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-bottom: 20px;
        }

        .back-info-item {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .back-info-label {
            font-size: 11px;
            opacity: 0.6;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .back-info-value {
            font-size: 14px;
            font-weight: 600;
        }

        /* Sections */
        .back-section {
            margin-bottom: 20px;
        }

        .back-section-title {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 1px;
            opacity: 0.6;
            margin-bottom: 10px;
        }

        /* Streaming Services */
        .streaming-services {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .streaming-badge {
            padding: 8px 14px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
        }

        /* Cast */
        .cast-list {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .cast-member {
            padding: 5px 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            font-size: 12px;
        }

        /* Friends Watching */
        .friends-categories {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .friends-category {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .friends-category:hover {
            background: rgba(255, 255, 255, 0.08);
        }

        .friends-avatars-stack {
            display: flex;
            align-items: center;
        }

        .friends-avatars-stack img {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: 2px solid #1a1a1a;
            margin-left: -10px;
            object-fit: cover;
        }

        .friends-avatars-stack img:first-child {
            margin-left: 0;
        }

        .friends-category-text {
            flex: 1;
            font-size: 14px;
            font-weight: 500;
        }

        .friends-category-text .count {
            font-weight: 600;
        }

        /* Show Comments */
        .show-comments-section {
            margin-bottom: 20px;
        }

        .comment-input-container {
            display: flex;
            gap: 10px;
            margin-bottom: 16px;
            padding: 12px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }

        .comment-input-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            object-fit: cover;
            flex-shrink: 0;
        }

        .comment-input-wrapper {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .comment-input {
            width: 100%;
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: white;
            font-size: 13px;
            font-family: inherit;
            resize: none;
            min-height: 60px;
        }

        .comment-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .comment-input:focus {
            outline: none;
            border-color: rgba(255, 255, 255, 0.4);
        }

        .comment-submit-btn {
            align-self: flex-end;
            padding: 6px 16px;
            background: linear-gradient(135deg, #FF006E, #FF8E53);
            border: none;
            border-radius: 6px;
            color: white;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .comment-submit-btn:active {
            transform: scale(0.95);
        }

        .comments-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .comment-item {
            display: flex;
            gap: 10px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
        }

        .comment-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            object-fit: cover;
            flex-shrink: 0;
        }

        .comment-content {
            flex: 1;
        }

        .comment-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 4px;
        }

        .comment-username {
            font-size: 13px;
            font-weight: 600;
        }

        .comment-timestamp {
            font-size: 11px;
            opacity: 0.6;
        }

        .comment-text {
            font-size: 13px;
            line-height: 1.4;
            opacity: 0.9;
            margin-bottom: 8px;
        }

        .comment-actions {
            display: flex;
            gap: 12px;
            margin-top: 6px;
            justify-content: flex-end;
        }

        .comment-like-btn {
            display: flex;
            align-items: center;
            gap: 4px;
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.6);
            font-size: 11px;
            font-weight: 600;
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 12px;
            transition: all 0.2s;
        }

        .comment-like-btn:hover {
            background: rgba(255, 255, 255, 0.05);
            color: rgba(255, 255, 255, 0.9);
        }

        .comment-like-btn.liked {
            color: #FF3B5C;
        }

        .comment-like-btn svg {
            width: 14px;
            height: 14px;
            stroke: currentColor;
            fill: none;
            stroke-width: 2;
        }

        .comment-like-btn.liked svg {
            fill: currentColor;
        }

        .load-more-btn {
            width: 100%;
            padding: 10px;
            margin-top: 8px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: white;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
        }

        .load-more-btn:hover {
            background: rgba(255, 255, 255, 0.08);
        }

        /* Similar Shows */
        .similar-shows {
            display: flex;
            gap: 12px;
            overflow-x: auto;
            padding-bottom: 10px;
        }

        .similar-show {
            flex-shrink: 0;
            width: 100px;
            height: 150px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            display: flex;
            align-items: flex-end;
            padding: 8px;
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }

        .similar-show::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(to top, rgba(0,0,0,0.8), transparent);
        }

        .similar-show-title {
            font-size: 11px;
            font-weight: 600;
            position: relative;
            z-index: 1;
        }

        /* Share Icon SVG */
        .share-icon {
            width: 18px;
            height: 20px;
        }

        /* Comments Tab on Front Card */
        .comments-tab {
            position: absolute;
            bottom: 0;
            left: 20px;
            right: 70px;
            background: rgba(20, 20, 20, 0.95);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-top-left-radius: 16px;
            border-top-right-radius: 16px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            z-index: 5;
            transition: transform 0.3s ease, opacity 0.3s ease;
            max-height: 70%;
            overflow: hidden;
            transform: translateY(100%);
            opacity: 0;
            pointer-events: none;
        }

        .comments-tab.visible {
            transform: translateY(0);
            opacity: 1;
            pointer-events: auto;
        }

        .comments-preview {
            padding: 16px 20px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .comments-full {
            display: none;
            padding: 20px;
            padding-bottom: 0;
            /* Flex grow to fill space, but allow scrolling */
            flex: 1;
            min-height: 0;
            overflow-y: scroll;
            overflow-x: hidden;
            -webkit-overflow-scrolling: touch;
            overscroll-behavior: contain;
            overscroll-behavior-y: contain;
            touch-action: pan-y;
            /* Enable iOS scrolling */
            -webkit-transform: translateZ(0);
            transform: translateZ(0);
            will-change: scroll-position;
        }

        .comments-tab.expanded .comments-preview {
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .comments-tab.expanded .comments-full {
            display: block;
        }

        .activity-comment-item {
            margin-bottom: 16px;
            padding-bottom: 16px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .activity-comment-item:last-child {
            border-bottom: none;
        }

        .activity-comment-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 6px;
        }

        .activity-comment-avatar {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .activity-comment-username {
            font-size: 13px;
            font-weight: 600;
        }

        .activity-comment-time {
            font-size: 11px;
            opacity: 0.6;
            margin-left: auto;
        }

        .activity-comment-text {
            font-size: 13px;
            line-height: 1.4;
            opacity: 0.9;
            margin-left: 38px;
        }

        .activity-comment-item .comment-actions {
            justify-content: flex-end;
        }

        .activity-comment-input-wrapper {
            padding: 16px 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .activity-comment-input {
            flex: 1;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 20px;
            padding: 10px 16px;
            color: white;
            font-size: 13px;
            outline: none;
        }

        .activity-comment-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .send-btn {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        .send-btn svg {
            width: 16px;
            height: 16px;
            fill: white;
        }

        /* Your Rating */
        .your-rating-container {
            margin-top: 20px;
        }

        .your-rating-buttons {
            display: flex;
            gap: 12px;
            margin-top: 12px;
        }

        .rating-btn {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            padding: 16px 12px;
            background: rgba(255, 255, 255, 0.05);
            border: 1.5px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .rating-btn:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        .rating-btn.active {
            background: rgba(255, 59, 92, 0.15);
            border-color: #FF3B5C;
        }

        .rating-btn svg {
            width: 28px;
            height: 28px;
            stroke: rgba(255, 255, 255, 0.6);
            fill: none;
            stroke-width: 1.5;
            transition: all 0.2s;
        }

        .rating-btn:hover svg {
            stroke: rgba(255, 255, 255, 0.9);
        }

        .rating-btn.active svg {
            stroke: #FF3B5C;
            fill: #FF3B5C;
        }

        /* Filled state for rating icons */
        .rating-btn.active[data-rating="meh"] svg circle {
            fill: #FF3B5C;
        }

        .rating-btn.active[data-rating="like"] svg path {
            fill: #FF3B5C;
        }

        .rating-btn.active[data-rating="love"] svg path {
            fill: #FF3B5C;
        }

        .rating-btn-label {
            font-size: 12px;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.7);
            transition: color 0.2s;
        }

        .rating-btn:hover .rating-btn-label {
            color: rgba(255, 255, 255, 0.9);
        }

        .rating-btn.active .rating-btn-label {
            color: #FF3B5C;
        }

        /* Friends Ratings */
        .friends-ratings-container {
            margin-top: 20px;
        }

        .friends-ratings {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            padding: 16px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 10px;
        }

        .friends-ratings-title {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 1px;
            opacity: 0.6;
            margin: 0;
            padding-top: 11px;
        }

        .friends-ratings-stats {
            display: flex;
            gap: 16px;
        }

        .rating-stat {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        .rating-icon-wrapper {
            width: 42px;
            height: 42px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .rating-icon-wrapper svg {
            width: 20px;
            height: 20px;
            stroke: white;
            fill: none;
            stroke-width: 1.5;
        }

        /* Active user rating styling */
        .rating-icon-wrapper.active-user-rating {
            background: rgba(255, 59, 92, 0.15);
            border: 2px solid #FF3B5C;
        }

        .rating-icon-wrapper.active-user-rating svg {
            stroke: #FF3B5C;
            fill: #FF3B5C;
        }

        .rating-count {
            position: absolute;
            top: -4px;
            right: -4px;
            background: linear-gradient(135deg, #FF006E, #FF8E53);
            color: white;
            font-size: 10px;
            font-weight: 600;
            min-width: 18px;
            height: 18px;
            border-radius: 9px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 4px;
            border: 2px solid #1a1a1a;
        }

        .rating-label {
            font-size: 11px;
            opacity: 0.7;
        }

        /* Close button on back */
        .close-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: rgba(60, 60, 60, 0.6);
            backdrop-filter: blur(10px);
            border: 1.5px solid rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 10;
        }

        .close-btn svg {
            width: 20px;
            height: 20px;
            stroke: white;
            stroke-width: 2;
        }

        /* Instructions */
        .instructions {
            margin-top: 20px;
            font-size: 12px;
            color: #666;
            text-align: center;
            padding: 0 20px;
        }

        /* Action Overlay Modal */
        .action-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s ease;
            border-radius: 16px;
            overflow: hidden;
        }

        .action-overlay.visible {
            opacity: 1;
            pointer-events: auto;
        }

        .action-modal {
            position: absolute;
            background: rgba(20, 20, 20, 0.98);
            backdrop-filter: blur(30px);
            -webkit-backdrop-filter: blur(30px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 16px;
            padding: 16px;
            width: 240px;
            transform: scale(0.9);
            opacity: 0;
            transition: all 0.2s ease;
        }

        /* Counter-rotate modal when on back of card */
        .card.flipped .action-modal {
            transform: scale(0.9) rotateY(180deg);
        }

        .action-overlay.visible .action-modal {
            transform: scale(1);
            opacity: 1;
        }

        /* Counter-rotate modal when visible and card is flipped */
        .card.flipped .action-overlay.visible .action-modal {
            transform: scale(1) rotateY(180deg);
            opacity: 1;
        }

        .action-modal-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }

        .action-modal-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .action-modal-item:active {
            transform: scale(0.95);
        }

        .action-modal-icon {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .action-modal-item:hover .action-modal-icon {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 255, 255, 0.3);
        }

        /* iOS body scroll lock when card is flipped */
        /* Using overflow: hidden instead of position: fixed to allow nested scrolling */
        body.scroll-locked {
            overflow: hidden;
            height: 100%;
            position: relative;
            -webkit-overflow-scrolling: touch;
            overscroll-behavior: none;
            overscroll-behavior-y: none;
        }

        /* Prevent iOS rubber band scrolling when card is flipped */
        html.scroll-locked {
            overflow: hidden;
            height: 100%;
            overscroll-behavior: none;
            overscroll-behavior-y: none;
        }

        .action-modal-icon svg {
            width: 20px;
            height: 20px;
            stroke: white;
            fill: none;
            stroke-width: 1.5;
        }

        .action-modal-label {
            font-size: 10px;
            font-weight: 500;
            opacity: 0.8;
            text-align: center;
            line-height: 1.2;
        }

        .action-modal-divider {
            grid-column: 1 / -1;
            height: 1px;
            background: rgba(255, 255, 255, 0.1);
            margin: 2px 0;
        }

        .watchlist-badge {
            position: absolute;
            top: -2px;
            right: -2px;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: linear-gradient(135deg, #FF006E, #FF8E53);
            border: 2px solid rgba(20, 20, 20, 0.98);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .watchlist-badge svg {
            width: 10px;
            height: 10px;
            stroke: white;
            fill: none;
            stroke-width: 2;
        }

        /* Navigation Bar */
        .card-nav {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding: 12px 20px;
            display: flex;
            gap: 8px;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            overflow-x: auto;
        }

        .nav-btn {
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: rgba(255, 255, 255, 0.7);
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            white-space: nowrap;
            text-decoration: none;
        }

        .nav-btn:hover {
            background: rgba(255, 255, 255, 0.15);
            color: rgba(255, 255, 255, 0.9);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .nav-btn.active {
            background: linear-gradient(135deg, #FF006E, #FF8E53);
            border-color: #FF006E;
            color: white;
        }

        .nav-btn.disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .nav-btn.disabled:hover {
            background: rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.7);
            border-color: rgba(255, 255, 255, 0.2);
        }

        body {
            padding-top: 0;
        }
    </style>
</head>
<body>
    <!-- Navigation -->

    <div class="card-container">
                <div class="card" id="activityCard">
                    <!-- FRONT OF CARD -->
                    <div class="card-face card-front">
                        <div class="card-background">
                            <img src="https://image.tmdb.org/t/p/original/z2yahl2uefxDCl0nogcRBstwruJ.jpg" alt="House of the Dragon">
                        </div>
                        <div class="background-overlay"></div>

                        <div class="menu-btn" onclick="flipCard()">
                            <svg viewBox="0 0 24 24">
                                <circle cx="12" cy="6" r="1.5" fill="white"/>
                                <circle cx="12" cy="12" r="1.5" fill="white"/>
                                <circle cx="12" cy="18" r="1.5" fill="white"/>
                            </svg>
                        </div>

                        <div class="card-content">
                            <!-- Coming Soon Badge (NO user header) -->
                            <div class="glass-badge" style="background: rgba(168, 85, 247, 0.25); backdrop-filter: blur(10px); padding: 8px 14px; border-radius: 12px; font-size: 13px; font-weight: 700; display: inline-flex; align-items: center; gap: 6px; margin-bottom: 12px; border: 1px solid rgba(168, 85, 247, 0.5);">
                                <svg viewBox="0 0 24 24" style="width: 16px; height: 16px; fill: none; stroke: currentColor; stroke-width="1.5">
                                    <circle cx="12" cy="12" r="10"/>
                                    <path d="M12 6v6l4 2"/>
                                </svg>
                                Coming Soon on May 5, 2026
                            </div>

                            <div class="show-title">House of the Dragon Season 2</div>
                            <div class="show-meta">
                                2024 <span class="meta-dot">•</span> Fantasy Drama <span class="meta-dot">•</span> 8 episodes
                            </div>

                            <div class="friend-avatars">
                                <div class="friend-avatars-stack">
                                    <img src="https://i.pravatar.cc/150?img=6" alt="Friend 1">
                                    <img src="https://i.pravatar.cc/150?img=7" alt="Friend 2">
                                </div>
                                <div class="friend-count">5 friends want to watch this</div>
                            </div>
                        </div>

                        <div class="side-actions">
                            <!-- Want to Watch Button -->
                            <div>
                                <div class="action-btn">
                                    <svg viewBox="0 0 24 24" style="position: relative;">
                                        <path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"/>
                                        <!-- Plus sign overlay -->
                                        <line x1="12" y1="6" x2="12" y2="12" stroke="white" stroke-width="1.5" stroke-linecap="round"/>
                                        <line x1="9" y1="9" x2="15" y2="9" stroke="white" stroke-width="1.5" stroke-linecap="round"/>
                                    </svg>
                                </div>
                            </div>
                            <!-- Remind Me Button -->
                            <div>
                                <div class="action-btn">
                                    <svg viewBox="0 0 24 24" fill="none">
                                        <path d="M18 8A6 6 0 1 0 6 8c0 7-3 9-3 9h18s-3-2-3-9M13.73 21a2 2 0 0 1-3.46 0" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                </div>
                            </div>
                        </div>

                    </div>

                    <!-- BACK OF CARD -->
                    <div class="card-face card-back">
                        <div class="close-btn" onclick="flipCard()">
                            <svg viewBox="0 0 24 24">
                                <line x1="18" y1="6" x2="6" y2="18"/>
                                <line x1="6" y1="6" x2="18" y2="18"/>
                            </svg>
                        </div>

                        <div class="card-back-content">
                            <!-- Title Section -->
                            <div class="back-title-section">
                                <h1 class="back-title">House of the Dragon - Season 2</h1>
                                <div class="back-meta">
                                    <span class="back-year">2024</span>
                                    <span class="meta-dot">•</span>
                                    <span>Fantasy, Drama</span>
                                    <span class="meta-dot">•</span>
                                    <span class="back-rating">8 episodes</span>
                                </div>

                                <!-- Badges -->
                                <div class="back-badges">
                                    <div class="back-badge season">S2</div>
                                    <div class="back-badge type">TV</div>
                                    <div class="back-badge network">HBO</div>
                                    <div class="back-badge trailer">▶ Trailer</div>
                                </div>
                            </div>

                            <!-- Synopsis -->
                            <p class="back-synopsis collapsed" id="synopsis">
                                The final season finds Jimmy McGill living as Gene Takavic in Omaha. As he completes his transformation into criminal lawyer Saul Goodman, tensions between Gus Fring and Lalo Salamanca escalate. Kim and Jimmy's relationship reaches a breaking point as they navigate an increasingly dangerous world.
                            </p>
                            <span class="read-more" onclick="toggleSynopsis()">Read more</span>

                            <!-- Action Icons -->
                            <div class="back-action-icons">
                                <button class="back-icon-btn primary">
                                    <svg viewBox="0 0 24 24" style="width: 22px; height: 22px;">
                                        <path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z" fill="white"/>
                                        <!-- Plus sign overlay -->
                                        <line x1="12" y1="6" x2="12" y2="12" stroke="black" stroke-width="1.5" stroke-linecap="round"/>
                                        <line x1="9" y1="9" x2="15" y2="9" stroke="black" stroke-width="1.5" stroke-linecap="round"/>
                                    </svg>
                                </button>
                                <button class="back-icon-btn">
                                    <svg viewBox="0 0 24 24" style="width: 22px; height: 22px;">
                                        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" stroke="white" fill="none" stroke-width="1.5"/>
                                    </svg>
                                </button>
                                <button class="back-icon-btn">
                                    <svg viewBox="0 0 20 22" fill="none" style="width: 20px; height: 22px;">
                                        <path d="M10 3L10 14M10 3L6 7M10 3L14 7" stroke="white" stroke-width="2" stroke-linecap="round"/>
                                        <path d="M17 11V18C17 19 16 20 15 20H5C4 20 3 19 3 18V11" stroke="white" stroke-width="2" stroke-linecap="round"/>
                                    </svg>
                                </button>
                            </div>

                            <!-- Info Grid -->
                            <div class="back-info-grid">
                                <div class="back-info-item">
                                    <span class="back-info-label">Creator</span>
                                    <span class="back-info-value">Vince Gilligan</span>
                                </div>
                                <div class="back-info-item">
                                    <span class="back-info-label">Genre</span>
                                    <span class="back-info-value">Fantasy, Drama</span>
                                </div>
                            </div>

                            <!-- Cast -->
                            <div class="back-section">
                                <h3 class="back-section-title">Cast</h3>
                                <div class="cast-list">
                                    <span class="cast-member">Bryan Cranston</span>
                                    <span class="cast-member">Aaron Paul</span>
                                    <span class="cast-member">Anna Gunn</span>
                                    <span class="cast-member">Dean Norris</span>
                                </div>
                            </div>

                            <!-- Friends Watching -->
                            <!-- Friends Want to Watch (Coming Soon - no ratings yet) -->
                            <div class="back-section">
                                <h3 class="back-section-title">Friends Want to Watch</h3>
                                <div class="friends-categories">
                                    <div class="friends-category" onclick="expandFriendsCategory('want')">
                                        <div class="friends-avatars-stack">
                                            <img src="https://i.pravatar.cc/150?img=8" alt="Friend">
                                            <img src="https://i.pravatar.cc/150?img=9" alt="Friend">
                                            <img src="https://i.pravatar.cc/150?img=10" alt="Friend">
                                        </div>
                                        <div class="friends-category-text">
                                            <span class="count">5</span> friends want to watch
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Show Comments -->
                            <div class="back-section show-comments-section">
                                <h3 class="back-section-title">Show Comments</h3>

                                <!-- Comment Input -->
                                <div class="comment-input-container">
                                    <img src="https://i.pravatar.cc/150?img=1" alt="You" class="comment-input-avatar">
                                    <div class="comment-input-wrapper">
                                        <textarea class="comment-input" placeholder="Share your thoughts about this show..."></textarea>
                                        <button class="comment-submit-btn">Post Comment</button>
                                    </div>
                                </div>

                                <!-- Comments List -->
                                <div class="comments-list">
                                    <div class="comment-item">
                                        <img src="https://i.pravatar.cc/150?img=14" alt="Jessica" class="comment-avatar">
                                        <div class="comment-content">
                                            <div class="comment-header">
                                                <span class="comment-username">Jessica Chen</span>
                                                <span class="comment-timestamp">3 days ago</span>
                                            </div>
                                            <div class="comment-text">This season is absolutely phenomenal. The tension keeps building and you can't look away. Best TV I've ever watched.</div>
                                            <div class="comment-actions">
                                                <button class="comment-like-btn liked" onclick="toggleCommentLike(this, event)">
                                                    <svg viewBox="0 0 24 24">
                                                        <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
                                                    </svg>
                                                    <span>24</span>
                                                </button>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="comment-item">
                                        <img src="https://i.pravatar.cc/150?img=15" alt="Marcus" class="comment-avatar">
                                        <div class="comment-content">
                                            <div class="comment-header">
                                                <span class="comment-username">Marcus Williams</span>
                                                <span class="comment-timestamp">1 week ago</span>
                                            </div>
                                            <div class="comment-text">Started this last month and I'm already hooked. Can't believe I waited so long to watch it!</div>
                                            <div class="comment-actions">
                                                <button class="comment-like-btn" onclick="toggleCommentLike(this, event)">
                                                    <svg viewBox="0 0 24 24">
                                                        <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
                                                    </svg>
                                                    <span>8</span>
                                                </button>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="comment-item">
                                        <img src="https://i.pravatar.cc/150?img=16" alt="Emma" class="comment-avatar">
                                        <div class="comment-content">
                                            <div class="comment-header">
                                                <span class="comment-username">Emma Davis</span>
                                                <span class="comment-timestamp">2 weeks ago</span>
                                            </div>
                                            <div class="comment-text">The character development in this season is incredible. Every episode leaves me wanting more.</div>
                                            <div class="comment-actions">
                                                <button class="comment-like-btn" onclick="toggleCommentLike(this)">
                                                    <svg viewBox="0 0 24 24">
                                                        <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
                                                    </svg>
                                                    <span>15</span>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Load More Button -->
                                <button class="load-more-btn" onclick="loadMoreComments()">Load More Comments</button>
                            </div>

                            <!-- Similar Shows -->
                            <div class="back-section">
                                <h3 class="back-section-title">Similar Shows</h3>
                                <div class="similar-shows">
                                    <div class="similar-show" style="background: linear-gradient(to top, rgba(0,0,0,0.8), transparent), linear-gradient(135deg, #4B0082, #FF1493);">
                                        <div class="similar-show-title">House of the Dragon</div>
                                    </div>
                                    <div class="similar-show" style="background: linear-gradient(to top, rgba(0,0,0,0.8), transparent), linear-gradient(135deg, #1a1a1a, #4a4a4a);">
                                        <div class="similar-show-title">Ozark</div>
                                    </div>
                                    <div class="similar-show" style="background: linear-gradient(to top, rgba(0,0,0,0.8), transparent), linear-gradient(135deg, #8B0000, #FF6347);">
                                        <div class="similar-show-title">Narcos</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Action Overlay Modal -->
                    <div class="action-overlay" id="actionOverlay" onclick="closeActionOverlay(event)">
                        <div class="action-modal" id="actionModal" onclick="event.stopPropagation()">
                            <div class="action-modal-grid">
                                <!-- Rating Icons -->
                <div class="action-modal-item" onclick="selectAction('meh')">
                    <div class="action-modal-icon">
                        <svg viewBox="0 0 24 24">
                            <circle cx="12" cy="12" r="10"/>
                            <line x1="8" y1="15" x2="16" y2="15"/>
                            <line x1="9" y1="9" x2="9" y2="10"/>
                            <line x1="15" y1="9" x2="15" y2="10"/>
                        </svg>
                    </div>
                    <div class="action-modal-label">Meh</div>
                </div>

                <div class="action-modal-item" onclick="selectAction('like')">
                    <div class="action-modal-icon">
                        <svg viewBox="0 0 24 24">
                            <path d="M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"/>
                        </svg>
                    </div>
                    <div class="action-modal-label">Like</div>
                </div>

                <div class="action-modal-item" onclick="selectAction('love')">
                    <div class="action-modal-icon">
                        <svg viewBox="0 0 24 24">
                            <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
                        </svg>
                    </div>
                    <div class="action-modal-label">Love</div>
                </div>

                <!-- Divider -->
                <div class="action-modal-divider"></div>

                <!-- Watchlist Icons -->
                <div class="action-modal-item" onclick="selectAction('want-to-watch')">
                    <div class="action-modal-icon">
                        <svg viewBox="0 0 24 24">
                            <path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"/>
                        </svg>
                        <div class="watchlist-badge">
                            <svg viewBox="0 0 12 12">
                                <line x1="6" y1="2" x2="6" y2="10"/>
                                <line x1="2" y1="6" x2="10" y2="6"/>
                            </svg>
                        </div>
                    </div>
                    <div class="action-modal-label">Want To</div>
                </div>

                <div class="action-modal-item" onclick="selectAction('watching')">
                    <div class="action-modal-icon">
                        <svg viewBox="0 0 24 24">
                            <polygon points="5 3 19 12 5 21 5 3"/>
                        </svg>
                        <div class="watchlist-badge">
                            <svg viewBox="0 0 12 12">
                                <line x1="6" y1="2" x2="6" y2="10"/>
                                <line x1="2" y1="6" x2="10" y2="6"/>
                            </svg>
                        </div>
                    </div>
                    <div class="action-modal-label">Watching</div>
                </div>

                <div class="action-modal-item" onclick="selectAction('watched')">
                    <div class="action-modal-icon">
                        <svg viewBox="0 0 24 24">
                            <circle cx="12" cy="12" r="10"/>
                            <polyline points="9 12 11 14 15 10"/>
                        </svg>
                        <div class="watchlist-badge">
                            <svg viewBox="0 0 12 12">
                                <line x1="6" y1="2" x2="6" y2="10"/>
                                <line x1="2" y1="6" x2="10" y2="6"/>
                            </svg>
                        </div>
                    </div>
                    <div class="action-modal-label">Watched</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

    <div class="instructions">
        Click the three-dot menu to flip the card • Click comment button to view activity comments
    </div>

    <div class="instructions">
        Version 2.2 • Last updated: Nov 10, 2025 at 07:42 PM (Updated to match cards 2 and 3: Added iOS scroll lock CSS, updated scroll management with MutationObserver, added momentum scrolling, updated toggleCommentLike to handle event parameter and prevent bubbling)
    </div>

    <script>
        function flipCard() {
            const card = document.getElementById('activityCard');
            card.classList.toggle('flipped');
        }

        function toggleSynopsis() {
            const synopsis = document.getElementById('synopsis');
            const readMore = event.target;
            synopsis.classList.toggle('collapsed');
            readMore.textContent = synopsis.classList.contains('collapsed') ? 'Read more' : 'Show less';
        }

        function expandFriendsCategory(category) {
            // Placeholder function for expanding friends categories
            console.log('Expanding friends category:', category);
            // In a real implementation, this would show a modal or expanded view
            alert(`Would show all friends in "${category}" category`);
        }

        function loadMoreComments() {
            // Placeholder function for loading more comments
            console.log('Loading more comments...');
            // In a real implementation, this would fetch and append more comments
            alert('Would load more comments from the API');
        }

        function toggleActivityComments(event) {
            event.stopPropagation();
            const commentsTab = document.querySelector('.card-front .comments-tab');
            commentsTab.classList.toggle('visible');
        }

        function toggleCommentsExpanded(event) {
            event.stopPropagation();
            const commentsTab = event.currentTarget;
            commentsTab.classList.toggle('expanded');
        }

        // Close comments when clicking outside
        document.addEventListener('click', (e) => {
            if (!e.target.closest('.comments-tab') && !e.target.closest('.action-btn')) {
                const commentsTab = document.querySelector('.card-front .comments-tab');
                if (commentsTab) {
                    commentsTab.classList.remove('visible');
                }
            }
        });

        // Like button interaction (front card only)
        document.querySelectorAll('.card-front .action-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                e.preventDefault();
                        e.stopPropagation();
                // Add visual feedback
                btn.style.transform = 'scale(0.9)';
                setTimeout(() => {
                    btn.style.transform = 'scale(1)';
                }, 100);
            });
        });

        // Prevent body scroll
        document.body.style.overflow = 'hidden';

        // Action overlay functions
        function toggleActionOverlay(event) {
            event.stopPropagation();
            const overlay = document.getElementById('actionOverlay');
            const modal = document.getElementById('actionModal');
            const button = event.currentTarget;
            const card = document.getElementById('activityCard');

            // Get button and card positions
            const buttonRect = button.getBoundingClientRect();
            const cardRect = card.getBoundingClientRect();

            // Check if card is flipped
            const isFlipped = card.classList.contains('flipped');

            // Reset positioning styles
            modal.style.right = 'auto';
            modal.style.left = 'auto';
            modal.style.top = 'auto';

            if (isFlipped) {
                // For back of card: center horizontally, position in middle of card
                const leftPos = (cardRect.width - 240) / 2; // center modal (240px width)
                const topPos = (cardRect.height - 280) / 2; // center vertically (modal height ~280px)

                modal.style.left = leftPos + 'px';
                modal.style.top = topPos + 'px';
            } else {
                // For front of card: position to the left of button, vertically aligned
                const rightPos = cardRect.right - buttonRect.left + 8;
                const topPos = buttonRect.top - cardRect.top + buttonRect.height / 2 - 120;
                modal.style.right = rightPos + 'px';
                modal.style.top = topPos + 'px';
            }

            overlay.classList.toggle('visible');
        }

        function closeActionOverlay(event) {
            if (event.target === event.currentTarget) {
                const overlay = document.getElementById('actionOverlay');
                overlay.classList.remove('visible');
            }
        }

        function selectAction(action) {
            console.log('Selected action:', action);
            // In a real implementation, this would update the user's status with the show
            alert(`You selected: ${action.replace(/-/g, ' ')}`);

            // Close the overlay
            const overlay = document.getElementById('actionOverlay');
            overlay.classList.remove('visible');
        }

        // Close overlay when clicking outside
        document.addEventListener('click', (e) => {
            const overlay = document.getElementById('actionOverlay');
            if (overlay.classList.contains('visible') && !e.target.closest('.action-modal') && !e.target.closest('.action-btn')) {
                overlay.classList.remove('visible');
            }
        });

        // Comment like button interaction
        function toggleCommentLike(button, event) {
            // Prevent event from bubbling up and closing the comments bubble
            if (event) {
                event.stopPropagation();
                event.preventDefault();
            }
            
            button.classList.toggle('liked');
            const countSpan = button.querySelector('span');
            let count = parseInt(countSpan.textContent);

            if (button.classList.contains('liked')) {
                count++;
            } else {
                count--;
            }

            countSpan.textContent = count;

            // Add visual feedback
            button.style.transform = 'scale(0.9)';
            setTimeout(() => {
                button.style.transform = 'scale(1)';
            }, 100);
        }

        // User rating interaction
        function setUserRating(button, rating) {
            // Remove active class from all rating buttons
            document.querySelectorAll('.rating-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            // Add active class to clicked button
            button.classList.add('active');

            // Visual feedback
            button.style.transform = 'scale(0.95)';
            setTimeout(() => {
                button.style.transform = 'scale(1)';
            }, 100);

            // Log the rating (in production, this would save to database)
            console.log('User rated show as:', rating);
        }

        // iOS scroll lock/unlock functions
        function lockBodyScroll() {
            document.body.classList.add('scroll-locked');
            document.documentElement.classList.add('scroll-locked');
        }
        
        function unlockBodyScroll() {
            document.body.classList.remove('scroll-locked');
            document.documentElement.classList.remove('scroll-locked');
        }

        // iOS scroll management
        const card = document.getElementById('activityCard');
        const cardBackContent = document.querySelector('.card-back-content');
        
        if (card) {
            // Watch for card flip and manage scroll locking
            const observer = new MutationObserver((mutations) => {
                mutations.forEach((mutation) => {
                    if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
                        const isFlipped = card.classList.contains('flipped');
                        if (isFlipped) {
                            // Card flipped - lock body scroll
                            lockBodyScroll();
                        } else {
                            // Card unflipped - unlock body scroll
                            unlockBodyScroll();
                        }
                    }
                });
            });
            
            observer.observe(card, { attributes: true, attributeFilter: ['class'] });
            
            // Initial state check
            if (card.classList.contains('flipped')) {
                lockBodyScroll();
            }
        }
        
        // iOS scroll workaround - manually handle scrolling for transformed elements
        // This is necessary because iOS Safari has a bug where scrolling doesn't work
        // inside elements with CSS transforms (like our card flip)
        if (cardBackContent) {
            let touchStartY = 0;
            let touchStartScrollTop = 0;
            let lastTouchY = 0;
            let lastTouchTime = 0;
            let velocity = 0;
            let momentumAnimation = null;
            let isScrolling = false;
            
            // Smooth scroll with easing
            function smoothScrollTo(targetScrollTop) {
                const startScrollTop = cardBackContent.scrollTop;
                const distance = targetScrollTop - startScrollTop;
                const duration = Math.min(Math.abs(distance) * 0.5, 300); // Max 300ms
                const startTime = performance.now();
                
                function animate(currentTime) {
                    const elapsed = currentTime - startTime;
                    const progress = Math.min(elapsed / duration, 1);
                    
                    // Easing function (ease-out cubic)
                    const easeOutCubic = 1 - Math.pow(1 - progress, 3);
                    
                    const currentScrollTop = startScrollTop + (distance * easeOutCubic);
                    cardBackContent.scrollTop = currentScrollTop;
                    
                    if (progress < 1) {
                        momentumAnimation = requestAnimationFrame(animate);
                    } else {
                        momentumAnimation = null;
                    }
                }
                
                if (momentumAnimation) {
                    cancelAnimationFrame(momentumAnimation);
                }
                momentumAnimation = requestAnimationFrame(animate);
            }
            
            // Momentum scrolling after touch ends
            function applyMomentum() {
                if (Math.abs(velocity) < 0.1) {
                    velocity = 0;
                    return;
                }
                
                const maxScroll = cardBackContent.scrollHeight - cardBackContent.clientHeight;
                const currentScrollTop = cardBackContent.scrollTop;
                const friction = 0.92; // Deceleration factor - Apple-like smooth deceleration
                
                // Apply friction to velocity
                velocity *= friction;
                
                // Calculate new scroll position
                // Positive velocity = swiping down = scroll down (increase scrollTop)
                // Negative velocity = swiping up = scroll up (decrease scrollTop)
                let newScrollTop = currentScrollTop + velocity;
                
                // Stop at boundaries
                if (newScrollTop < 0) {
                    newScrollTop = 0;
                    velocity = 0;
                } else if (newScrollTop > maxScroll) {
                    newScrollTop = maxScroll;
                    velocity = 0;
                }
                
                cardBackContent.scrollTop = newScrollTop;
                
                // Continue momentum if velocity is still significant
                if (Math.abs(velocity) > 0.1) {
                    requestAnimationFrame(applyMomentum);
                } else {
                    velocity = 0;
                }
            }
            
            cardBackContent.addEventListener('touchstart', (e) => {
                if (!card.classList.contains('flipped')) return;
                
                // Prevent event from bubbling to body
                e.stopPropagation();
                
                // Cancel any ongoing momentum
                if (momentumAnimation) {
                    cancelAnimationFrame(momentumAnimation);
                    momentumAnimation = null;
                }
                velocity = 0;
                isScrolling = true;
                
                touchStartY = e.touches[0].clientY;
                touchStartScrollTop = cardBackContent.scrollTop;
                lastTouchY = touchStartY;
                lastTouchTime = performance.now();
            }, { passive: true });
            
            cardBackContent.addEventListener('touchmove', (e) => {
                if (!card.classList.contains('flipped')) return;
                
                // Prevent event from bubbling to body to prevent page bounce
                e.stopPropagation();
                
                const touchY = e.touches[0].clientY;
                const currentTime = performance.now();
                const deltaTime = currentTime - lastTouchTime;
                
                // Calculate velocity for momentum based on recent movement
                // Positive velocity = scrolling down (content moving up)
                if (deltaTime > 0 && lastTouchY !== 0) {
                    const deltaY = lastTouchY - touchY; // Positive when swiping down
                    velocity = (deltaY / deltaTime) * 16; // Normalize to 60fps, scale up for momentum
                }
                
                const deltaY = touchStartY - touchY;
                const newScrollTop = touchStartScrollTop + deltaY;
                const maxScroll = cardBackContent.scrollHeight - cardBackContent.clientHeight;
                
                // Manually set scroll position with rubber band effect at boundaries
                if (newScrollTop >= 0 && newScrollTop <= maxScroll) {
                    cardBackContent.scrollTop = newScrollTop;
                    // Prevent default to stop body scroll when we're handling it
                    e.preventDefault();
                } else if (newScrollTop < 0) {
                    // Rubber band effect - reduce scroll amount when past boundary
                    const overscroll = Math.abs(newScrollTop);
                    cardBackContent.scrollTop = -overscroll * 0.3;
                    // Always prevent default at boundaries to prevent page bounce
                    e.preventDefault();
                } else if (newScrollTop > maxScroll) {
                    // Rubber band effect
                    const overscroll = newScrollTop - maxScroll;
                    cardBackContent.scrollTop = maxScroll + (overscroll * 0.3);
                    // Always prevent default at boundaries to prevent page bounce
                    e.preventDefault();
                }
                
                lastTouchY = touchY;
                lastTouchTime = currentTime;
            }, { passive: false });
            
            cardBackContent.addEventListener('touchend', (e) => {
                if (!card.classList.contains('flipped')) return;
                
                // Prevent event from bubbling to body
                e.stopPropagation();
                
                isScrolling = false;
                const maxScroll = cardBackContent.scrollHeight - cardBackContent.clientHeight;
                const currentScrollTop = cardBackContent.scrollTop;
                
                // Snap back if overscrolled
                if (currentScrollTop < 0) {
                    smoothScrollTo(0);
                    velocity = 0;
                } else if (currentScrollTop > maxScroll) {
                    smoothScrollTo(maxScroll);
                    velocity = 0;
                } else if (Math.abs(velocity) > 0.5) {
                    // Apply momentum scrolling - continue in the direction of the swipe
                    applyMomentum();
                } else {
                    velocity = 0;
                }
            }, { passive: true });
        }

        // iOS scroll handler for comments section (same technique as card back)
        const commentsFull = document.querySelector('.comments-full');
        if (commentsFull) {
            let touchStartY = 0;
            let touchStartScrollTop = 0;
            let lastTouchY = 0;
            let lastTouchTime = 0;
            let velocity = 0;
            let momentumAnimation = null;

            function smoothScrollToComments(targetScrollTop) {
                const startScrollTop = commentsFull.scrollTop;
                const distance = targetScrollTop - startScrollTop;
                const duration = Math.min(Math.abs(distance) * 0.5, 300);
                const startTime = performance.now();

                function animate(currentTime) {
                    const elapsed = currentTime - startTime;
                    const progress = Math.min(elapsed / duration, 1);
                    const easeOutCubic = 1 - Math.pow(1 - progress, 3);
                    const currentScrollTop = startScrollTop + (distance * easeOutCubic);
                    commentsFull.scrollTop = currentScrollTop;

                    if (progress < 1) {
                        momentumAnimation = requestAnimationFrame(animate);
                    }
                }

                momentumAnimation = requestAnimationFrame(animate);
            }

            function applyMomentumComments() {
                if (Math.abs(velocity) < 0.1) return;

                const maxScroll = commentsFull.scrollHeight - commentsFull.clientHeight;
                const friction = 0.92;
                velocity *= friction;

                let newScrollTop = commentsFull.scrollTop + velocity;

                if (newScrollTop < 0) newScrollTop = 0;
                else if (newScrollTop > maxScroll) newScrollTop = maxScroll;

                commentsFull.scrollTop = newScrollTop;

                if (Math.abs(velocity) > 0.1) {
                    requestAnimationFrame(applyMomentumComments);
                }
            }

            commentsFull.addEventListener('touchstart', (e) => {
                if (!card.classList.contains('flipped')) return;

                e.stopPropagation();
                touchStartY = e.touches[0].clientY;
                touchStartScrollTop = commentsFull.scrollTop;
                lastTouchY = touchStartY;
                lastTouchTime = performance.now();
                velocity = 0;

                if (momentumAnimation) {
                    cancelAnimationFrame(momentumAnimation);
                }
            }, { passive: true });

            commentsFull.addEventListener('touchmove', (e) => {
                if (!card.classList.contains('flipped')) return;

                e.preventDefault();
                e.stopPropagation();

                const currentY = e.touches[0].clientY;
                const currentTime = performance.now();
                const deltaY = currentY - lastTouchY;
                const deltaTime = currentTime - lastTouchTime;

                if (deltaTime > 0) {
                    velocity = (deltaY / deltaTime) * 16;
                }

                const scrollDelta = touchStartY - currentY;
                const maxScroll = commentsFull.scrollHeight - commentsFull.clientHeight;
                let newScrollTop = touchStartScrollTop + scrollDelta;

                if (newScrollTop < 0) {
                    newScrollTop = newScrollTop * 0.3;
                } else if (newScrollTop > maxScroll) {
                    const overscroll = newScrollTop - maxScroll;
                    newScrollTop = maxScroll + (overscroll * 0.3);
                }

                commentsFull.scrollTop = newScrollTop;
                lastTouchY = currentY;
                lastTouchTime = currentTime;
            }, { passive: false });

            commentsFull.addEventListener('touchend', (e) => {
                if (!card.classList.contains('flipped')) return;

                e.stopPropagation();

                const maxScroll = commentsFull.scrollHeight - commentsFull.clientHeight;
                const currentScrollTop = commentsFull.scrollTop;

                if (currentScrollTop < 0) {
                    smoothScrollToComments(0);
                    velocity = 0;
                } else if (currentScrollTop > maxScroll) {
                    smoothScrollToComments(maxScroll);
                    velocity = 0;
                } else if (Math.abs(velocity) > 0.5) {
                    applyMomentumComments();
                } else {
                    velocity = 0;
                }
            }, { passive: true });
        }

        // iOS scroll fix: Lock body when card is flipped
        const flipBtn = document.querySelector('.action-btn');
        let scrollPosition = 0;

        if (flipBtn) {
            flipBtn.addEventListener('click', () => {
                setTimeout(() => {
                    if (card.classList.contains('flipped')) {
                        // Card is now flipped - lock body scroll
                        scrollPosition = window.pageYOffset;
                        document.body.style.overflow = 'hidden';
                        document.body.style.position = 'fixed';
                        document.body.style.top = `-${scrollPosition}px`;
                        document.body.style.width = '100%';
                    } else {
                        // Card is now unflipped - restore body scroll
                        document.body.style.removeProperty('overflow');
                        document.body.style.removeProperty('position');
                        document.body.style.removeProperty('top');
                        document.body.style.removeProperty('width');
                        window.scrollTo(0, scrollPosition);
                    }
                }, 100);
            });
        }
    </script>
</body>
</html>
