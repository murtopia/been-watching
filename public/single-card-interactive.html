<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Card 1 - User Activity Card</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #ffffff;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
        }

        /* ========================================
           REUSABLE COMPONENT CLASSES
           Use these classes across all card types
           ======================================== */

        /* Glassmorphism Effects */
        .glass-light {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .glass-medium {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
        }

        .glass-heavy {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
        }

        .glass-dark {
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        /* Action Buttons - 40x40px circular */
        .action-btn-base {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .action-btn-primary {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
        }

        .action-btn-primary:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }

        .action-btn-liked {
            background: rgba(255, 59, 92, 0.2);
        }

        /* Icon Buttons - For headers and nav */
        .icon-btn-base {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .icon-btn-glass {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
        }

        .icon-btn-glass:hover {
            background: rgba(255, 255, 255, 0.25);
        }

        /* Typography Utilities */
        .text-title {
            font-size: 16px;
            font-weight: 600;
            line-height: 1.3;
        }

        .text-username {
            font-size: 14px;
            font-weight: 600;
        }

        .text-meta {
            font-size: 13px;
            opacity: 0.7;
        }

        .text-body {
            font-size: 14px;
            line-height: 1.5;
        }

        .text-small {
            font-size: 12px;
        }

        .text-tiny {
            font-size: 11px;
        }

        /* Badge Styles */
        .badge-base {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }

        .badge-glass {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(8px);
        }

        .badge-accent {
            background: rgba(255, 59, 92, 0.2);
            color: #FF3B5C;
        }

        .badge-success {
            background: rgba(52, 211, 153, 0.2);
            color: #34D399;
        }

        /* Avatar Styles */
        .avatar-small {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            border: 2px solid rgba(255, 255, 255, 0.3);
            object-fit: cover;
        }

        .avatar-medium {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border: 2px solid rgba(255, 255, 255, 0.3);
            object-fit: cover;
        }

        .avatar-large {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            border: 2px solid rgba(255, 255, 255, 0.3);
            object-fit: cover;
        }

        /* Overlay Styles */
        .overlay-dark {
            background: linear-gradient(to bottom,
                rgba(0, 0, 0, 0) 0%,
                rgba(0, 0, 0, 0.3) 50%,
                rgba(0, 0, 0, 0.9) 100%
            );
        }

        .overlay-black {
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(8px);
        }

        /* Comment Components */
        .comment-header-base {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 6px;
        }

        .comment-actions-base {
            display: flex;
            gap: 12px;
            margin-top: 6px;
        }

        .comment-like-btn-base {
            display: flex;
            align-items: center;
            gap: 4px;
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.6);
            font-size: 11px;
            font-weight: 600;
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 12px;
            transition: all 0.2s;
        }

        .comment-like-btn-base:hover {
            background: rgba(255, 255, 255, 0.05);
            color: rgba(255, 255, 255, 0.9);
        }

        .comment-like-btn-base.liked {
            color: #FF3B5C;
        }

        /* Layout Utilities */
        .flex-center {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .flex-between {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .flex-gap-sm {
            gap: 8px;
        }

        .flex-gap-md {
            gap: 12px;
        }

        .flex-gap-lg {
            gap: 16px;
        }

        /* Spacing Utilities */
        .p-sm { padding: 8px; }
        .p-md { padding: 12px; }
        .p-lg { padding: 16px; }
        .p-xl { padding: 20px; }

        .mb-sm { margin-bottom: 8px; }
        .mb-md { margin-bottom: 12px; }
        .mb-lg { margin-bottom: 16px; }

        /* Border Radius */
        .rounded-sm { border-radius: 8px; }
        .rounded-md { border-radius: 12px; }
        .rounded-lg { border-radius: 16px; }
        .rounded-full { border-radius: 50%; }

        /* Transitions */
        .transition-base {
            transition: all 0.2s ease;
        }

        .transition-medium {
            transition: all 0.3s ease;
        }

        /* Card container with 3D perspective */
        .card-container {
            width: 398px;
            height: 645px;
            margin: 20px 16px;
            perspective: 1000px;
            position: relative;
        }

        /* Card with flip transformation */
        .card {
            width: 100%;
            height: 100%;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 16px;
            touch-action: none;
        }

        .card.flipped {
            transform: rotateY(180deg);
        }

        /* Card faces */
        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            -webkit-backface-visibility: hidden;
            border-radius: 16px;
        }

        .card-front {
            z-index: 2;
            overflow: hidden;
            border-radius: 16px;
        }

        .card-back {
            transform: rotateY(180deg);
            background: linear-gradient(to bottom, #1a1a1a 0%, #0a0a0a 100%);
            /* Clip to card bounds but allow child scrolling */
            overflow: hidden;
            /* Ensure proper stacking */
            z-index: 1;
        }

        /* Front card styles (existing design) */
        .card-background {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        .card-background img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .background-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom,
                rgba(0, 0, 0, 0) 0%,
                rgba(0, 0, 0, 0.3) 50%,
                rgba(0, 0, 0, 0.9) 100%
            );
            z-index: 2;
        }

        .card-content {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 20px;
            padding-bottom: 40px;
            z-index: 3;
            color: white;
        }

        /* User header */
        .user-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: 1.5px solid white;
            object-fit: cover;
        }

        .user-info {
            flex: 1;
        }

        .username {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 1px;
        }

        .timestamp {
            font-size: 11px;
            font-weight: 400;
            opacity: 0.7;
        }

        /* Show info */
        .show-title {
            font-size: 16px;
            font-weight: 600;
            line-height: 1.3;
            margin-bottom: 6px;
        }

        .show-meta {
            font-size: 12px;
            font-weight: 400;
            opacity: 0.85;
            margin-bottom: 6px;
        }

        .meta-dot {
            margin: 0 4px;
            opacity: 0.5;
        }

        /* Friend avatars */
        .friend-avatars {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 10px;
        }

        .friend-avatars-stack {
            display: flex;
            margin-right: 6px;
        }

        .friend-avatars-stack img {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            border: 1.5px solid #000;
            margin-left: -6px;
        }

        .friend-avatars-stack img:first-child {
            margin-left: 0;
        }

        .friend-count {
            font-size: 12px;
            font-weight: 400;
            opacity: 0.85;
        }

        /* Menu button (three dots) */
        .menu-btn {
            position: absolute;
            top: 20px;
            right: 12px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(60, 60, 60, 0.4);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1.5px solid rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 6;
            transition: all 0.2s;
        }

        .menu-btn:active {
            transform: scale(0.9);
        }

        .menu-btn svg {
            width: 20px;
            height: 20px;
        }

        /* Side actions */
        .side-actions {
            position: absolute;
            right: 12px;
            bottom: 60px;
            z-index: 4;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .action-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(60, 60, 60, 0.4);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1.5px solid rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .action-btn:active {
            transform: scale(0.9);
        }

        .action-btn svg {
            width: 24px;
            height: 24px;
            stroke: white;
            fill: none;
            stroke-width: 1.5;
        }

        .action-btn.liked svg {
            fill: #FF3B5C;
            stroke: #FF3B5C;
        }

        .action-count {
            text-align: center;
            font-size: 12px;
            font-weight: 600;
            margin-top: 2px;
            color: white;
        }

        /* Back of card styles */
        .card-back-content {
            padding: 20px 16px;
            padding-top: 50px;
            padding-bottom: 20px;
            /* Use absolute positioning to fill card-back */
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            width: 100%;
            /* Enable scrolling - content will overflow */
            overflow-y: scroll;
            overflow-x: hidden;
            /* Critical for iOS momentum scrolling - MUST be present */
            -webkit-overflow-scrolling: touch !important;
            overscroll-behavior: contain;
            overscroll-behavior-y: contain;
            touch-action: pan-y;
            -webkit-tap-highlight-color: transparent;
            z-index: 1;
            /* Ensure the element can receive touch events */
            pointer-events: auto;
            /* Force repaint for iOS */
            will-change: scroll-position;
        }

        /* Title Section */
        .back-title-section {
            margin-bottom: 16px;
        }

        .back-title {
            font-size: 22px;
            font-weight: 700;
            margin-bottom: 6px;
            letter-spacing: -0.5px;
        }

        .back-meta {
            display: flex;
            align-items: center;
            gap: 8px;
            flex-wrap: wrap;
            margin-bottom: 12px;
        }

        .back-year {
            font-size: 14px;
            opacity: 0.9;
        }

        .back-rating {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            font-size: 14px;
            font-weight: 600;
        }

        .meta-dot {
            opacity: 0.5;
        }

        /* Badge Pills */
        .back-badges {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
            margin-bottom: 14px;
        }

        .back-badge {
            padding: 8px 14px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            text-align: center;
            min-width: 36px;
        }

        /* Synopsis */
        .back-synopsis {
            font-size: 14px;
            line-height: 1.5;
            opacity: 0.9;
            margin-bottom: 8px;
        }

        .back-synopsis.collapsed {
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .read-more {
            color: #FF006E;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            margin-bottom: 16px;
            display: block;
            text-align: right;
        }

        /* Action Icons */
        .back-action-icons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .back-icon-btn {
            width: 42px;
            height: 42px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.2s ease;
            color: white;
        }

        .back-icon-btn:active {
            transform: scale(0.9);
        }

        .back-icon-btn.primary {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        /* Info Grid */
        .back-info-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-bottom: 20px;
        }

        .back-info-item {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .back-info-label {
            font-size: 11px;
            opacity: 0.6;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .back-info-value {
            font-size: 14px;
            font-weight: 600;
        }

        /* Sections */
        .back-section {
            margin-bottom: 20px;
        }

        .back-section-title {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 1px;
            opacity: 0.6;
            margin-bottom: 10px;
        }

        /* Streaming Services */
        .streaming-services {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .streaming-badge {
            padding: 8px 14px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
        }

        /* Cast */
        .cast-list {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .cast-member {
            padding: 5px 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            font-size: 12px;
        }

        /* Friends Watching */
        .friends-categories {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .friends-category {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .friends-category:hover {
            background: rgba(255, 255, 255, 0.08);
        }

        .friends-avatars-stack {
            display: flex;
            align-items: center;
        }

        .friends-avatars-stack img {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: 2px solid #1a1a1a;
            margin-left: -10px;
            object-fit: cover;
        }

        .friends-avatars-stack img:first-child {
            margin-left: 0;
        }

        .friends-category-text {
            flex: 1;
            font-size: 14px;
            font-weight: 500;
        }

        .friends-category-text .count {
            font-weight: 600;
        }

        /* Show Comments */
        .show-comments-section {
            margin-bottom: 20px;
        }

        .comment-input-container {
            display: flex;
            gap: 10px;
            margin-bottom: 16px;
            padding: 12px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }

        .comment-input-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            object-fit: cover;
            flex-shrink: 0;
        }

        .comment-input-wrapper {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .comment-input {
            width: 100%;
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: white;
            font-size: 13px;
            font-family: inherit;
            resize: none;
            min-height: 60px;
        }

        .comment-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .comment-input:focus {
            outline: none;
            border-color: rgba(255, 255, 255, 0.4);
        }

        .comment-submit-btn {
            align-self: flex-end;
            padding: 6px 16px;
            background: linear-gradient(135deg, #FF006E, #FF8E53);
            border: none;
            border-radius: 6px;
            color: white;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .comment-submit-btn:active {
            transform: scale(0.95);
        }

        .comments-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .comment-item {
            display: flex;
            gap: 10px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
        }

        .comment-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            object-fit: cover;
            flex-shrink: 0;
        }

        .comment-content {
            flex: 1;
        }

        .comment-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 4px;
        }

        .comment-username {
            font-size: 13px;
            font-weight: 600;
        }

        .comment-timestamp {
            font-size: 11px;
            opacity: 0.6;
        }

        .comment-text {
            font-size: 13px;
            line-height: 1.4;
            opacity: 0.9;
            margin-bottom: 8px;
        }

        .comment-actions {
            display: flex;
            gap: 12px;
            margin-top: 6px;
            justify-content: flex-end;
        }

        .comment-like-btn {
            display: flex;
            align-items: center;
            gap: 4px;
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.6);
            font-size: 11px;
            font-weight: 600;
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 12px;
            transition: all 0.2s;
        }

        .comment-like-btn:hover {
            background: rgba(255, 255, 255, 0.05);
            color: rgba(255, 255, 255, 0.9);
        }

        .comment-like-btn.liked {
            color: #FF3B5C;
        }

        .comment-like-btn svg {
            width: 14px;
            height: 14px;
            stroke: currentColor;
            fill: none;
            stroke-width: 2;
        }

        .comment-like-btn.liked svg {
            fill: currentColor;
        }

        .load-more-btn {
            width: 100%;
            padding: 10px;
            margin-top: 8px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: white;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
        }

        .load-more-btn:hover {
            background: rgba(255, 255, 255, 0.08);
        }

        /* Similar Shows */
        .similar-shows {
            display: flex;
            gap: 12px;
            overflow-x: auto;
            padding-bottom: 10px;
        }

        .similar-show {
            flex-shrink: 0;
            width: 100px;
            height: 150px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            display: flex;
            align-items: flex-end;
            padding: 8px;
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }

        .similar-show::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(to top, rgba(0,0,0,0.8), transparent);
        }

        .similar-show-title {
            font-size: 11px;
            font-weight: 600;
            position: relative;
            z-index: 1;
        }

        /* Share Icon SVG */
        .share-icon {
            width: 18px;
            height: 20px;
        }

        /* Comments Tab on Front Card */
        .comments-tab {
            position: absolute;
            bottom: 0;
            left: 10px; /* Match left margin */
            right: 10px; /* Match left margin - fully covers nav circles */
            background: rgba(20, 20, 20, 0.95);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-top-left-radius: 16px;
            border-top-right-radius: 16px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            z-index: 5;
            transition: transform 0.3s ease, opacity 0.3s ease;
            max-height: 70%;
            overflow: hidden;
            transform: translateY(100%);
            opacity: 0;
            pointer-events: none;
            /* Use flexbox to keep input fixed at bottom */
            display: flex;
            flex-direction: column;
        }

        .comments-tab.visible {
            transform: translateY(0);
            opacity: 1;
            pointer-events: auto;
            transition: transform 0.3s ease, opacity 0.3s ease;
        }
        
        /* When keyboard is visible, smoothly shift up */
        .comments-tab.visible.keyboard-visible {
            transition: transform 0.25s ease-out, opacity 0.3s ease;
        }

        .comments-preview {
            padding: 16px 20px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 8px;
        }
        
        .comments-preview-content {
            display: flex;
            align-items: center;
            gap: 8px;
            flex: 1;
        }
        
        .comments-close-btn {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            flex-shrink: 0;
            transition: background 0.2s;
        }
        
        .comments-close-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .comments-close-btn:active {
            transform: scale(0.9);
        }
        
        .comments-close-btn svg {
            width: 14px;
            height: 14px;
            stroke: white;
            stroke-width: 2;
        }

        .comments-full {
            display: none;
            padding: 20px;
            padding-bottom: 0;
            /* Flex grow to fill space, but allow scrolling */
            flex: 1;
            min-height: 0;
            overflow-y: scroll;
            overflow-x: hidden;
            -webkit-overflow-scrolling: touch;
            overscroll-behavior: contain;
            overscroll-behavior-y: contain;
            touch-action: pan-y;
            /* Enable iOS scrolling */
            -webkit-transform: translateZ(0);
            transform: translateZ(0);
            will-change: scroll-position;
        }

        .comments-tab.expanded .comments-preview {
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .comments-tab.expanded .comments-full {
            display: block;
        }

        .activity-comment-item {
            margin-bottom: 16px;
            padding-bottom: 16px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .activity-comment-item:last-child {
            border-bottom: none;
        }

        .activity-comment-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 6px;
        }

        .activity-comment-avatar {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .activity-comment-username {
            font-size: 13px;
            font-weight: 600;
        }

        .activity-comment-time {
            font-size: 11px;
            opacity: 0.6;
            margin-left: auto;
        }

        .activity-comment-text {
            font-size: 13px;
            line-height: 1.4;
            opacity: 0.9;
            margin-left: 38px;
        }

        .activity-comment-item .comment-actions {
            justify-content: flex-end;
        }

        .activity-comment-input-wrapper {
            padding: 16px 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            gap: 12px;
            align-items: center;
            /* Keep input fixed at bottom - don't shrink */
            flex-shrink: 0;
        }

        .activity-comment-input {
            flex: 1;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 20px;
            padding: 10px 16px;
            color: white;
            font-size: 16px; /* 16px prevents iOS zoom on focus */
            outline: none;
            -webkit-appearance: none;
            appearance: none;
        }

        .activity-comment-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .send-btn {
            width: 32px;
            height: 32px;
            min-width: 32px;
            min-height: 32px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            flex-shrink: 0; /* Prevent stretching in flex container */
        }

        .send-btn svg {
            width: 16px;
            height: 16px;
            fill: white;
        }

        /* Your Rating */
        .your-rating-container {
            margin-top: 20px;
        }

        .your-rating-buttons {
            display: flex;
            gap: 12px;
            margin-top: 12px;
        }

        .rating-btn {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            padding: 16px 12px;
            background: rgba(255, 255, 255, 0.05);
            border: 1.5px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .rating-btn:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        .rating-btn.active {
            background: rgba(255, 59, 92, 0.15);
            border-color: #FF3B5C;
        }

        .rating-btn svg {
            width: 28px;
            height: 28px;
            stroke: rgba(255, 255, 255, 0.6);
            fill: none;
            stroke-width: 1.5;
            transition: all 0.2s;
        }

        .rating-btn:hover svg {
            stroke: rgba(255, 255, 255, 0.9);
        }

        .rating-btn.active svg {
            stroke: #FF3B5C;
            fill: #FF3B5C;
        }

        /* Filled state for rating icons */
        .rating-btn.active[data-rating="meh"] svg circle {
            fill: #FF3B5C;
        }

        .rating-btn.active[data-rating="like"] svg path {
            fill: #FF3B5C;
        }

        .rating-btn.active[data-rating="love"] svg path {
            fill: #FF3B5C;
        }

        .rating-btn-label {
            font-size: 12px;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.7);
            transition: color 0.2s;
        }

        .rating-btn:hover .rating-btn-label {
            color: rgba(255, 255, 255, 0.9);
        }

        .rating-btn.active .rating-btn-label {
            color: #FF3B5C;
        }

        /* Friends Ratings */
        .friends-ratings-container {
            margin-top: 20px;
        }

        .friends-ratings {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            padding: 16px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 10px;
        }

        .friends-ratings-title {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 1px;
            opacity: 0.6;
            margin: 0;
            padding-top: 11px;
        }

        .friends-ratings-stats {
            display: flex;
            gap: 16px;
        }

        .rating-stat {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        .rating-icon-wrapper {
            width: 42px;
            height: 42px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .rating-icon-wrapper svg {
            width: 20px;
            height: 20px;
            stroke: white;
            fill: none;
            stroke-width: 1.5;
        }

        /* Active user rating styling */
        .rating-icon-wrapper.active-user-rating {
            background: rgba(255, 59, 92, 0.15);
            border: 2px solid #FF3B5C;
        }

        .rating-icon-wrapper.active-user-rating svg {
            stroke: #FF3B5C;
            fill: #FF3B5C;
        }

        .rating-count {
            position: absolute;
            top: -4px;
            right: -4px;
            background: linear-gradient(135deg, #FF006E, #FF8E53);
            color: white;
            font-size: 10px;
            font-weight: 600;
            min-width: 18px;
            height: 18px;
            border-radius: 9px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 4px;
            border: 2px solid #1a1a1a;
        }

        .rating-label {
            font-size: 11px;
            opacity: 0.7;
        }

        /* Close button on back */
        .close-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: rgba(60, 60, 60, 0.6);
            backdrop-filter: blur(10px);
            border: 1.5px solid rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 10;
        }

        .close-btn svg {
            width: 20px;
            height: 20px;
            stroke: white;
            stroke-width: 2;
        }

        /* Instructions */
        .instructions {
            margin-top: 20px;
            font-size: 12px;
            color: #666;
            text-align: center;
            padding: 0 20px;
            transition: opacity 0.2s ease, transform 0.2s ease;
        }
        
        /* Hide instructions when keyboard is visible to reduce gap */
        .instructions.keyboard-hidden {
            opacity: 0;
            transform: translateY(10px);
            pointer-events: none;
        }

        /* Action Overlay Modal */
        .action-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s ease;
            border-radius: 16px;
            overflow: hidden;
        }

        .action-overlay.visible {
            opacity: 1;
            pointer-events: auto;
        }

        .action-modal {
            position: absolute;
            background: rgba(20, 20, 20, 0.98);
            backdrop-filter: blur(30px);
            -webkit-backdrop-filter: blur(30px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 16px;
            padding: 16px;
            width: 240px;
            transform: scale(0.9);
            opacity: 0;
            transition: all 0.2s ease;
        }

        /* Counter-rotate modal when on back of card */
        .card.flipped .action-modal {
            transform: scale(0.9) rotateY(180deg);
        }

        .action-overlay.visible .action-modal {
            transform: scale(1);
            opacity: 1;
        }

        /* Counter-rotate modal when visible and card is flipped */
        .card.flipped .action-overlay.visible .action-modal {
            transform: scale(1) rotateY(180deg);
            opacity: 1;
        }

        .action-modal-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }

        .action-modal-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .action-modal-item:active {
            transform: scale(0.95);
        }

        .action-modal-icon {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .action-modal-item:hover .action-modal-icon {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .action-modal-icon svg {
            width: 20px;
            height: 20px;
            stroke: white;
            fill: none;
            stroke-width: 1.5;
        }

        .action-modal-label {
            font-size: 10px;
            font-weight: 500;
            opacity: 0.8;
            text-align: center;
            line-height: 1.2;
        }

        .action-modal-divider {
            grid-column: 1 / -1;
            height: 1px;
            background: rgba(255, 255, 255, 0.1);
            margin: 2px 0;
        }

        .watchlist-badge {
            position: absolute;
            top: -2px;
            right: -2px;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: linear-gradient(135deg, #FF006E, #FF8E53);
            border: 2px solid rgba(20, 20, 20, 0.98);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .watchlist-badge svg {
            width: 10px;
            height: 10px;
            stroke: white;
            fill: none;
            stroke-width: 2;
        }

        /* iOS body scroll lock when card is flipped */
        /* Using overflow: hidden instead of position: fixed to allow nested scrolling */
        body.scroll-locked {
            overflow: hidden;
            height: 100%;
            position: relative;
            -webkit-overflow-scrolling: touch;
        }

        /* Prevent iOS rubber band scrolling when card is flipped */
        html.scroll-locked {
            overflow: hidden;
            height: 100%;
        }
    </style>
</head>
<body>
    <div class="card-container">
                <div class="card" id="activityCard">
                    <!-- FRONT OF CARD -->
                    <div class="card-face card-front">
                        <div class="card-background">
                            <img src="https://image.tmdb.org/t/p/original/ztkUQFLlC19CCMYHW9o1zWhJRNq.jpg" alt="Breaking Bad">
                        </div>
                        <div class="background-overlay"></div>

                        <div class="menu-btn" onclick="flipCard()">
                            <svg viewBox="0 0 24 24">
                                <circle cx="12" cy="6" r="1.5" fill="white"/>
                                <circle cx="12" cy="12" r="1.5" fill="white"/>
                                <circle cx="12" cy="18" r="1.5" fill="white"/>
                            </svg>
                        </div>

                        <div class="card-content">
                            <div class="user-header">
                                <img src="https://i.pravatar.cc/150?img=1" alt="Sarah" class="user-avatar">
                                <div class="user-info">
                                    <div class="username">Sarah Miller</div>
                                    <div class="timestamp">2 hours ago</div>
                                </div>
                            </div>

                            <!-- Activity Badges -->
                            <div style="display: flex; gap: 8px; margin-bottom: 12px;">
                                <span style="background: rgba(255, 59, 92, 0.25); backdrop-filter: blur(10px); padding: 8px 14px; border-radius: 12px; font-size: 13px; font-weight: 700; display: inline-flex; align-items: center; gap: 6px; border: 1px solid rgba(255, 59, 92, 0.5);">
                                    <svg viewBox="0 0 24 24" style="width: 16px; height: 16px; fill: currentColor;">
                                        <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
                                    </svg>
                                    Loved
                                </span>
                                <span style="background: rgba(59, 130, 246, 0.25); backdrop-filter: blur(10px); padding: 8px 14px; border-radius: 12px; font-size: 13px; font-weight: 700; display: inline-flex; align-items: center; gap: 6px; border: 1px solid rgba(59, 130, 246, 0.5);">
                                    <svg viewBox="0 0 24 24" style="width: 16px; height: 16px; fill: currentColor;">
                                        <polygon points="5 3 19 12 5 21 5 3"/>
                                    </svg>
                                    Currently Watching
                                </span>
                            </div>

                            <div class="show-title">Breaking Bad Season 5</div>
                            <div class="show-meta">
                                2012 <span class="meta-dot">‚Ä¢</span> Crime Drama <span class="meta-dot">‚Ä¢</span> ‚≠ê 9.5
                            </div>

                            <div class="friend-avatars">
                                <div class="friend-avatars-stack">
                                    <img src="https://i.pravatar.cc/150?img=2" alt="Friend 1">
                                    <img src="https://i.pravatar.cc/150?img=3" alt="Friend 2">
                                    <img src="https://i.pravatar.cc/150?img=4" alt="Friend 3">
                                </div>
                                <div class="friend-count">8 friends also loved this</div>
                            </div>
                        </div>

                        <div class="side-actions">
                            <div>
                                <div class="action-btn liked">
                                    <svg viewBox="0 0 24 24">
                                        <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
                                    </svg>
                                </div>
                                <div class="action-count">124</div>
                            </div>
                            <div>
                                <div class="action-btn" onclick="toggleActionOverlay(event)">
                                    <svg viewBox="0 0 24 24">
                                        <path d="M19 11H13V5C13 4.44772 12.5523 4 12 4C11.4477 4 11 4.44772 11 5V11H5C4.44772 11 4 11.4477 4 12C4 12.5523 4.44772 13 5 13H11V19C11 19.5523 11.4477 20 12 20C12.5523 20 13 19.5523 13 19V13H19C19.5523 13 20 12.5523 20 12C20 11.4477 19.5523 11 19 11Z"/>
                                    </svg>
                                </div>
                            </div>
                            <div>
                                <div class="action-btn" onclick="toggleActivityComments(event)">
                                    <svg viewBox="0 0 24 24">
                                        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
                                    </svg>
                                </div>
                                <div class="action-count">12</div>
                            </div>
                        </div>

                        <div class="comments-tab" onclick="toggleCommentsExpanded(event)">
                            <div class="comments-preview">
                                <div class="comments-preview-content">üí¨ View 12 comments...</div>
                                <button class="comments-close-btn" onclick="closeCommentsTab(event)">
                                    <svg viewBox="0 0 24 24" fill="none">
                                        <line x1="18" y1="6" x2="6" y2="18"/>
                                        <line x1="6" y1="6" x2="18" y2="18"/>
                                    </svg>
                                </button>
                            </div>
                            <div class="comments-full">
                                <div class="activity-comment-item">
                                    <div class="activity-comment-header">
                                        <img src="https://i.pravatar.cc/150?img=5" alt="User" class="activity-comment-avatar">
                                        <div class="activity-comment-username">Mike Johnson</div>
                                        <div class="activity-comment-time">1h ago</div>
                                    </div>
                                    <div class="activity-comment-text">This finale was absolutely incredible! Best TV I've seen all year.</div>
                                    <div class="comment-actions">
                                        <button class="comment-like-btn liked" onclick="toggleCommentLike(this, event)">
                                            <svg viewBox="0 0 24 24">
                                                <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
                                            </svg>
                                            <span>8</span>
                                        </button>
                                    </div>
                                </div>
                                <div class="activity-comment-item">
                                    <div class="activity-comment-header">
                                        <img src="https://i.pravatar.cc/150?img=6" alt="User" class="activity-comment-avatar">
                                        <div class="activity-comment-username">Emma Davis</div>
                                        <div class="activity-comment-time">45m ago</div>
                                    </div>
                                    <div class="activity-comment-text">Can't believe it's over. What a ride! üé¨</div>
                                    <div class="comment-actions">
                                        <button class="comment-like-btn" onclick="toggleCommentLike(this, event)">
                                            <svg viewBox="0 0 24 24">
                                                <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
                                            </svg>
                                            <span>3</span>
                                        </button>
                                    </div>
                                </div>
                                <div class="activity-comment-item">
                                    <div class="activity-comment-header">
                                        <img src="https://i.pravatar.cc/150?img=7" alt="User" class="activity-comment-avatar">
                                        <div class="activity-comment-username">Alex Chen</div>
                                        <div class="activity-comment-time">2h ago</div>
                                    </div>
                                    <div class="activity-comment-text">The character development throughout this season was masterful. Every episode kept me on the edge of my seat!</div>
                                    <div class="comment-actions">
                                        <button class="comment-like-btn liked" onclick="toggleCommentLike(this, event)">
                                            <svg viewBox="0 0 24 24">
                                                <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
                                            </svg>
                                            <span>15</span>
                                        </button>
                                    </div>
                                </div>
                                <div class="activity-comment-item">
                                    <div class="activity-comment-header">
                                        <img src="https://i.pravatar.cc/150?img=8" alt="User" class="activity-comment-avatar">
                                        <div class="activity-comment-username">Jordan Martinez</div>
                                        <div class="activity-comment-time">3h ago</div>
                                    </div>
                                    <div class="activity-comment-text">Just finished binging the whole season. Mind = blown ü§Ø</div>
                                    <div class="comment-actions">
                                        <button class="comment-like-btn" onclick="toggleCommentLike(this, event)">
                                            <svg viewBox="0 0 24 24">
                                                <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
                                            </svg>
                                            <span>7</span>
                                        </button>
                                    </div>
                                </div>
                                <div class="activity-comment-item">
                                    <div class="activity-comment-header">
                                        <img src="https://i.pravatar.cc/150?img=9" alt="User" class="activity-comment-avatar">
                                        <div class="activity-comment-username">Sam Taylor</div>
                                        <div class="activity-comment-time">4h ago</div>
                                    </div>
                                    <div class="activity-comment-text">This is peak television. Nothing comes close!</div>
                                    <div class="comment-actions">
                                        <button class="comment-like-btn liked" onclick="toggleCommentLike(this, event)">
                                            <svg viewBox="0 0 24 24">
                                                <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
                                            </svg>
                                            <span>22</span>
                                        </button>
                                    </div>
                                </div>
                                <div class="activity-comment-item">
                                    <div class="activity-comment-header">
                                        <img src="https://i.pravatar.cc/150?img=10" alt="User" class="activity-comment-avatar">
                                        <div class="activity-comment-username">Riley Kim</div>
                                        <div class="activity-comment-time">5h ago</div>
                                    </div>
                                    <div class="activity-comment-text">The cinematography in the final episodes was absolutely stunning. Pure art.</div>
                                    <div class="comment-actions">
                                        <button class="comment-like-btn" onclick="toggleCommentLike(this, event)">
                                            <svg viewBox="0 0 24 24">
                                                <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
                                            </svg>
                                            <span>11</span>
                                        </button>
                                    </div>
                                </div>
                                <div class="activity-comment-item">
                                    <div class="activity-comment-header">
                                        <img src="https://i.pravatar.cc/150?img=11" alt="User" class="activity-comment-avatar">
                                        <div class="activity-comment-username">Casey Brown</div>
                                        <div class="activity-comment-time">6h ago</div>
                                    </div>
                                    <div class="activity-comment-text">I need to rewatch this immediately. So many details I missed the first time!</div>
                                    <div class="comment-actions">
                                        <button class="comment-like-btn" onclick="toggleCommentLike(this, event)">
                                            <svg viewBox="0 0 24 24">
                                                <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
                                            </svg>
                                            <span>5</span>
                                        </button>
                                    </div>
                                </div>
                                <div class="activity-comment-item">
                                    <div class="activity-comment-header">
                                        <img src="https://i.pravatar.cc/150?img=12" alt="User" class="activity-comment-avatar">
                                        <div class="activity-comment-username">Morgan Lee</div>
                                        <div class="activity-comment-time">7h ago</div>
                                    </div>
                                    <div class="activity-comment-text">The writing is just incredible. Every line matters.</div>
                                    <div class="comment-actions">
                                        <button class="comment-like-btn liked" onclick="toggleCommentLike(this, event)">
                                            <svg viewBox="0 0 24 24">
                                                <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
                                            </svg>
                                            <span>18</span>
                                        </button>
                                    </div>
                                </div>
                                <div class="activity-comment-item">
                                    <div class="activity-comment-header">
                                        <img src="https://i.pravatar.cc/150?img=13" alt="User" class="activity-comment-avatar">
                                        <div class="activity-comment-username">Taylor White</div>
                                        <div class="activity-comment-time">8h ago</div>
                                    </div>
                                    <div class="activity-comment-text">Best season finale I've ever seen. Period.</div>
                                    <div class="comment-actions">
                                        <button class="comment-like-btn" onclick="toggleCommentLike(this, event)">
                                            <svg viewBox="0 0 24 24">
                                                <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
                                            </svg>
                                            <span>9</span>
                                        </button>
                                    </div>
                                </div>
                                <div class="activity-comment-item">
                                    <div class="activity-comment-header">
                                        <img src="https://i.pravatar.cc/150?img=14" alt="User" class="activity-comment-avatar">
                                        <div class="activity-comment-username">Jamie Park</div>
                                        <div class="activity-comment-time">9h ago</div>
                                    </div>
                                    <div class="activity-comment-text">The emotional payoff was everything. I'm still processing it.</div>
                                    <div class="comment-actions">
                                        <button class="comment-like-btn liked" onclick="toggleCommentLike(this, event)">
                                            <svg viewBox="0 0 24 24">
                                                <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
                                            </svg>
                                            <span>14</span>
                                        </button>
                                    </div>
                                </div>
                                <div class="activity-comment-item">
                                    <div class="activity-comment-header">
                                        <img src="https://i.pravatar.cc/150?img=15" alt="User" class="activity-comment-avatar">
                                        <div class="activity-comment-username">Drew Anderson</div>
                                        <div class="activity-comment-time">10h ago</div>
                                    </div>
                                    <div class="activity-comment-text">This show set the bar so high, nothing else compares now.</div>
                                    <div class="comment-actions">
                                        <button class="comment-like-btn" onclick="toggleCommentLike(this, event)">
                                            <svg viewBox="0 0 24 24">
                                                <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
                                            </svg>
                                            <span>6</span>
                                        </button>
                                    </div>
                                </div>
                                <div class="activity-comment-item">
                                    <div class="activity-comment-header">
                                        <img src="https://i.pravatar.cc/150?img=16" alt="User" class="activity-comment-avatar">
                                        <div class="activity-comment-username">Quinn Rodriguez</div>
                                        <div class="activity-comment-time">11h ago</div>
                                    </div>
                                    <div class="activity-comment-text">The tension in every scene was masterfully crafted. Absolutely brilliant.</div>
                                    <div class="comment-actions">
                                        <button class="comment-like-btn" onclick="toggleCommentLike(this, event)">
                                            <svg viewBox="0 0 24 24">
                                                <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
                                            </svg>
                                            <span>12</span>
                                        </button>
                                    </div>
                                </div>
                                <div class="activity-comment-item">
                                    <div class="activity-comment-header">
                                        <img src="https://i.pravatar.cc/150?img=17" alt="User" class="activity-comment-avatar">
                                        <div class="activity-comment-username">Blake Thompson</div>
                                        <div class="activity-comment-time">12h ago</div>
                                    </div>
                                    <div class="activity-comment-text">I've been recommending this to everyone. It's that good!</div>
                                    <div class="comment-actions">
                                        <button class="comment-like-btn liked" onclick="toggleCommentLike(this, event)">
                                            <svg viewBox="0 0 24 24">
                                                <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
                                            </svg>
                                            <span>20</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="activity-comment-input-wrapper">
                                <input type="text" class="activity-comment-input" placeholder="Add a comment...">
                                <button class="send-btn">
                                    <svg viewBox="0 0 24 24">
                                        <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- BACK OF CARD -->
                    <div class="card-face card-back">
                        <div class="close-btn" onclick="flipCard()">
                            <svg viewBox="0 0 24 24">
                                <line x1="18" y1="6" x2="6" y2="18"/>
                                <line x1="6" y1="6" x2="18" y2="18"/>
                            </svg>
                        </div>

                        <div class="card-back-content">
                            <!-- Title Section -->
                            <div class="back-title-section">
                                <h1 class="back-title">Breaking Bad - Season 5</h1>
                                <div class="back-meta">
                                    <span class="back-year">2012</span>
                                    <span class="meta-dot">‚Ä¢</span>
                                    <span>Crime, Drama</span>
                                    <span class="meta-dot">‚Ä¢</span>
                                    <span class="back-rating">‚≠ê 9.5</span>
                                </div>

                                <!-- Badges -->
                                <div class="back-badges">
                                    <div class="back-badge season">S5</div>
                                    <div class="back-badge type">TV</div>
                                    <div class="back-badge network">AMC</div>
                                    <div class="back-badge trailer">‚ñ∂ Trailer</div>
                                </div>
                            </div>

                            <!-- Synopsis -->
                            <p class="back-synopsis collapsed" id="synopsis">
                                A high school chemistry teacher diagnosed with inoperable lung cancer turns to manufacturing and selling methamphetamine in order to secure his family's future. As Walter White descends deeper into the criminal underworld, he transforms from mild-mannered educator to ruthless drug kingpin.
                            </p>
                            <span class="read-more" onclick="toggleSynopsis()">Read more</span>

                            <!-- Action Icons -->
                            <div class="back-action-icons">
                                <button class="back-icon-btn primary" onclick="toggleActionOverlay(event)">
                                    <svg viewBox="0 0 24 24" style="width: 22px; height: 22px;">
                                        <path d="M19 11H13V5C13 4.44772 12.5523 4 12 4C11.4477 4 11 4.44772 11 5V11H5C4.44772 11 4 11.4477 4 12C4 12.5523 4.44772 13 5 13H11V19C11 19.5523 11.4477 20 12 20C12.5523 20 13 19.5523 13 19V13H19C19.5523 13 20 12.5523 20 12C20 11.4477 19.5523 11 19 11Z" stroke="white" fill="none" stroke-width="1.5"/>
                                    </svg>
                                </button>
                                <button class="back-icon-btn">
                                    <svg viewBox="0 0 24 24" style="width: 22px; height: 22px;">
                                        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" stroke="white" fill="none" stroke-width="1.5"/>
                                    </svg>
                                </button>
                                <button class="back-icon-btn">
                                    <svg viewBox="0 0 20 22" fill="none" style="width: 20px; height: 22px;">
                                        <path d="M10 3L10 14M10 3L6 7M10 3L14 7" stroke="white" stroke-width="2" stroke-linecap="round"/>
                                        <path d="M17 11V18C17 19 16 20 15 20H5C4 20 3 19 3 18V11" stroke="white" stroke-width="2" stroke-linecap="round"/>
                                    </svg>
                                </button>
                            </div>

                            <!-- Info Grid -->
                            <div class="back-info-grid">
                                <div class="back-info-item">
                                    <span class="back-info-label">Creator</span>
                                    <span class="back-info-value">Vince Gilligan</span>
                                </div>
                                <div class="back-info-item">
                                    <span class="back-info-label">Genre</span>
                                    <span class="back-info-value">Crime, Drama</span>
                                </div>
                            </div>

                            <!-- Cast -->
                            <div class="back-section">
                                <h3 class="back-section-title">Cast</h3>
                                <div class="cast-list">
                                    <span class="cast-member">Bryan Cranston</span>
                                    <span class="cast-member">Aaron Paul</span>
                                    <span class="cast-member">Anna Gunn</span>
                                    <span class="cast-member">Dean Norris</span>
                                </div>
                            </div>

                            <!-- Friends Watching -->
                            <div class="back-section">
                                <h3 class="back-section-title">Friends Watching</h3>
                                <div class="friends-categories">
                                    <div class="friends-category" onclick="expandFriendsCategory('watching')">
                                        <div class="friends-avatars-stack">
                                            <img src="https://i.pravatar.cc/150?img=5" alt="Friend">
                                            <img src="https://i.pravatar.cc/150?img=6" alt="Friend">
                                            <img src="https://i.pravatar.cc/150?img=7" alt="Friend">
                                        </div>
                                        <div class="friends-category-text">
                                            <span class="count">8</span> friends watching
                                        </div>
                                    </div>
                                    <div class="friends-category" onclick="expandFriendsCategory('want')">
                                        <div class="friends-avatars-stack">
                                            <img src="https://i.pravatar.cc/150?img=8" alt="Friend">
                                            <img src="https://i.pravatar.cc/150?img=9" alt="Friend">
                                            <img src="https://i.pravatar.cc/150?img=10" alt="Friend">
                                        </div>
                                        <div class="friends-category-text">
                                            <span class="count">12</span> friends want to watch
                                        </div>
                                    </div>
                                    <div class="friends-category" onclick="expandFriendsCategory('watched')">
                                        <div class="friends-avatars-stack">
                                            <img src="https://i.pravatar.cc/150?img=11" alt="Friend">
                                            <img src="https://i.pravatar.cc/150?img=12" alt="Friend">
                                            <img src="https://i.pravatar.cc/150?img=13" alt="Friend">
                                        </div>
                                        <div class="friends-category-text">
                                            <span class="count">42</span> friends watched
                                        </div>
                                    </div>
                                </div>

                                <!-- Friends Ratings -->
                                <div class="friends-ratings-container">
                                    <div class="friends-ratings">
                                        <h3 class="friends-ratings-title">Friends Ratings</h3>
                                        <div class="friends-ratings-stats">
                                            <div class="rating-stat">
                                                <div class="rating-icon-wrapper">
                                                    <svg viewBox="0 0 24 24">
                                                        <circle cx="12" cy="12" r="10"/>
                                                        <line x1="8" y1="15" x2="16" y2="15"/>
                                                        <line x1="9" y1="9" x2="9" y2="10"/>
                                                        <line x1="15" y1="9" x2="15" y2="10"/>
                                                    </svg>
                                                    <div class="rating-count">5</div>
                                                </div>
                                                <div class="rating-label">Meh</div>
                                            </div>
                                            <div class="rating-stat">
                                                <div class="rating-icon-wrapper">
                                                    <svg viewBox="0 0 24 24">
                                                        <path d="M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"/>
                                                    </svg>
                                                    <div class="rating-count">23</div>
                                                </div>
                                                <div class="rating-label">Like</div>
                                            </div>
                                            <div class="rating-stat">
                                                <div class="rating-icon-wrapper active-user-rating">
                                                    <svg viewBox="0 0 24 24">
                                                        <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
                                                    </svg>
                                                    <div class="rating-count">48</div>
                                                </div>
                                                <div class="rating-label">Love</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Show Comments -->
                            <div class="back-section show-comments-section">
                                <h3 class="back-section-title">Show Comments</h3>

                                <!-- Comment Input -->
                                <div class="comment-input-container">
                                    <img src="https://i.pravatar.cc/150?img=1" alt="You" class="comment-input-avatar">
                                    <div class="comment-input-wrapper">
                                        <textarea class="comment-input" placeholder="Share your thoughts about this show..."></textarea>
                                        <button class="comment-submit-btn">Post Comment</button>
                                    </div>
                                </div>

                                <!-- Comments List -->
                                <div class="comments-list">
                                    <div class="comment-item">
                                        <img src="https://i.pravatar.cc/150?img=14" alt="Jessica" class="comment-avatar">
                                        <div class="comment-content">
                                            <div class="comment-header">
                                                <span class="comment-username">Jessica Chen</span>
                                                <span class="comment-timestamp">3 days ago</span>
                                            </div>
                                            <div class="comment-text">This season is absolutely phenomenal. The tension keeps building and you can't look away. Best TV I've ever watched.</div>
                                            <div class="comment-actions">
                                                <button class="comment-like-btn liked" onclick="toggleCommentLike(this, event)">
                                                    <svg viewBox="0 0 24 24">
                                                        <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
                                                    </svg>
                                                    <span>24</span>
                                                </button>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="comment-item">
                                        <img src="https://i.pravatar.cc/150?img=15" alt="Marcus" class="comment-avatar">
                                        <div class="comment-content">
                                            <div class="comment-header">
                                                <span class="comment-username">Marcus Williams</span>
                                                <span class="comment-timestamp">1 week ago</span>
                                            </div>
                                            <div class="comment-text">Started this last month and I'm already hooked. Can't believe I waited so long to watch it!</div>
                                            <div class="comment-actions">
                                                <button class="comment-like-btn" onclick="toggleCommentLike(this, event)">
                                                    <svg viewBox="0 0 24 24">
                                                        <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
                                                    </svg>
                                                    <span>8</span>
                                                </button>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="comment-item">
                                        <img src="https://i.pravatar.cc/150?img=16" alt="Emma" class="comment-avatar">
                                        <div class="comment-content">
                                            <div class="comment-header">
                                                <span class="comment-username">Emma Davis</span>
                                                <span class="comment-timestamp">2 weeks ago</span>
                                            </div>
                                            <div class="comment-text">The character development in this season is incredible. Every episode leaves me wanting more.</div>
                                            <div class="comment-actions">
                                                <button class="comment-like-btn" onclick="toggleCommentLike(this, event)">
                                                    <svg viewBox="0 0 24 24">
                                                        <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
                                                    </svg>
                                                    <span>15</span>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Load More Button -->
                                <button class="load-more-btn" onclick="loadMoreComments()">Load More Comments</button>
                            </div>

                            <!-- Similar Shows -->
                            <div class="back-section">
                                <h3 class="back-section-title">Similar Shows</h3>
                                <div class="similar-shows">
                                    <div class="similar-show" style="background: linear-gradient(to top, rgba(0,0,0,0.8), transparent), linear-gradient(135deg, #4B0082, #FF1493);">
                                        <div class="similar-show-title">Better Call Saul</div>
                                    </div>
                                    <div class="similar-show" style="background: linear-gradient(to top, rgba(0,0,0,0.8), transparent), linear-gradient(135deg, #1a1a1a, #4a4a4a);">
                                        <div class="similar-show-title">Ozark</div>
                                    </div>
                                    <div class="similar-show" style="background: linear-gradient(to top, rgba(0,0,0,0.8), transparent), linear-gradient(135deg, #8B0000, #FF6347);">
                                        <div class="similar-show-title">Narcos</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Action Overlay Modal -->
                    <div class="action-overlay" id="actionOverlay" onclick="closeActionOverlay(event)">
                        <div class="action-modal" id="actionModal" onclick="event.stopPropagation()">
                            <div class="action-modal-grid">
                                <!-- Rating Icons -->
                <div class="action-modal-item" onclick="selectAction('meh')">
                    <div class="action-modal-icon">
                        <svg viewBox="0 0 24 24">
                            <circle cx="12" cy="12" r="10"/>
                            <line x1="8" y1="15" x2="16" y2="15"/>
                            <line x1="9" y1="9" x2="9" y2="10"/>
                            <line x1="15" y1="9" x2="15" y2="10"/>
                        </svg>
                    </div>
                    <div class="action-modal-label">Meh</div>
                </div>

                <div class="action-modal-item" onclick="selectAction('like')">
                    <div class="action-modal-icon">
                        <svg viewBox="0 0 24 24">
                            <path d="M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"/>
                        </svg>
                    </div>
                    <div class="action-modal-label">Like</div>
                </div>

                <div class="action-modal-item" onclick="selectAction('love')">
                    <div class="action-modal-icon">
                        <svg viewBox="0 0 24 24">
                            <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
                        </svg>
                    </div>
                    <div class="action-modal-label">Love</div>
                </div>

                <!-- Divider -->
                <div class="action-modal-divider"></div>

                <!-- Watchlist Icons -->
                <div class="action-modal-item" onclick="selectAction('want-to-watch')">
                    <div class="action-modal-icon">
                        <svg viewBox="0 0 24 24">
                            <path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"/>
                        </svg>
                        <div class="watchlist-badge">
                            <svg viewBox="0 0 12 12">
                                <line x1="6" y1="2" x2="6" y2="10"/>
                                <line x1="2" y1="6" x2="10" y2="6"/>
                            </svg>
                        </div>
                    </div>
                    <div class="action-modal-label">Want To</div>
                </div>

                <div class="action-modal-item" onclick="selectAction('watching')">
                    <div class="action-modal-icon">
                        <svg viewBox="0 0 24 24">
                            <polygon points="5 3 19 12 5 21 5 3"/>
                        </svg>
                        <div class="watchlist-badge">
                            <svg viewBox="0 0 12 12">
                                <line x1="6" y1="2" x2="6" y2="10"/>
                                <line x1="2" y1="6" x2="10" y2="6"/>
                            </svg>
                        </div>
                    </div>
                    <div class="action-modal-label">Watching</div>
                </div>

                <div class="action-modal-item" onclick="selectAction('watched')">
                    <div class="action-modal-icon">
                        <svg viewBox="0 0 24 24">
                            <circle cx="12" cy="12" r="10"/>
                            <polyline points="9 12 11 14 15 10"/>
                        </svg>
                        <div class="watchlist-badge">
                            <svg viewBox="0 0 12 12">
                                <line x1="6" y1="2" x2="6" y2="10"/>
                                <line x1="2" y1="6" x2="10" y2="6"/>
                            </svg>
                        </div>
                    </div>
                    <div class="action-modal-label">Watched</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

    <script>
        function flipCard() {
            const card = document.getElementById('activityCard');
            const isFlipped = card.classList.contains('flipped');
            
            card.classList.toggle('flipped');
            
            // Lock/unlock body scroll based on flip state
            if (!isFlipped) {
                // Card is being flipped to back - lock body scroll
                setTimeout(() => {
                    lockBodyScroll();
                }, 50); // Small delay to ensure transition starts
            } else {
                // Card is being flipped to front - unlock body scroll
                unlockBodyScroll();
            }
        }

        function toggleSynopsis() {
            const synopsis = document.getElementById('synopsis');
            const readMore = event.target;
            synopsis.classList.toggle('collapsed');
            readMore.textContent = synopsis.classList.contains('collapsed') ? 'Read more' : 'Show less';
        }

        function expandFriendsCategory(category) {
            // Placeholder function for expanding friends categories
            console.log('Expanding friends category:', category);
            // In a real implementation, this would show a modal or expanded view
            alert(`Would show all friends in "${category}" category`);
        }

        function loadMoreComments() {
            // Placeholder function for loading more comments
            console.log('Loading more comments...');
            // In a real implementation, this would fetch and append more comments
            alert('Would load more comments from the API');
        }

        function toggleActivityComments(event) {
            event.stopPropagation();
            const commentsTab = document.querySelector('.card-front .comments-tab');
            commentsTab.classList.toggle('visible');
        }

        function toggleCommentsExpanded(event) {
            event.stopPropagation();
            const commentsTab = event.currentTarget;
            commentsTab.classList.toggle('expanded');
            
            // Ensure input stays visible when expanding
            if (commentsTab.classList.contains('expanded')) {
                setTimeout(() => {
                    const input = commentsTab.querySelector('.activity-comment-input');
                    if (input) {
                        // Scroll comments section if needed to keep input visible
                        const commentsFull = commentsTab.querySelector('.comments-full');
                        if (commentsFull) {
                            commentsFull.scrollTop = 0;
                        }
                    }
                }, 100);
            }
        }
        
        function closeCommentsTab(event) {
            event.stopPropagation();
            const commentsTab = document.querySelector('.card-front .comments-tab');
            if (commentsTab) {
                commentsTab.classList.remove('visible');
                commentsTab.classList.remove('expanded');
            }
        }
        
        // Handle iOS keyboard appearance smoothly (Instagram-like behavior)
        const commentInput = document.querySelector('.activity-comment-input');
        if (commentInput) {
            // Prevent zoom and handle keyboard smoothly
            commentInput.addEventListener('focus', () => {
                const initialViewportHeight = window.visualViewport ? window.visualViewport.height : window.innerHeight;
                
                // Use visualViewport API for smooth keyboard handling (iOS 13+)
                if (window.visualViewport) {
                    const handleViewportChange = () => {
                        const viewportHeight = window.visualViewport.height;
                        const keyboardHeight = initialViewportHeight - viewportHeight;
                        
                        if (keyboardHeight > 0) {
                            // Keyboard is visible - adjust comments tab position
                            const commentsTab = document.querySelector('.comments-tab.expanded');
                            if (commentsTab) {
                                // Calculate how much to shift up
                                const inputRect = commentInput.getBoundingClientRect();
                                const tabRect = commentsTab.getBoundingClientRect();
                                const inputBottom = inputRect.bottom;
                                const viewportBottom = window.visualViewport.height;
                                
                                // If input would be hidden by keyboard, shift tab up
                                // Position input just above keyboard with minimal gap (like Instagram)
                                if (inputBottom > viewportBottom) {
                                    const shiftAmount = inputBottom - viewportBottom + 8; // Minimal 8px gap
                                    commentsTab.style.transform = `translateY(-${shiftAmount}px)`;
                                    commentsTab.classList.add('keyboard-visible');
                                    
                                    // Hide instructions/version info to reduce gap
                                    const instructions = document.querySelector('.instructions');
                                    if (instructions) {
                                        instructions.classList.add('keyboard-hidden');
                                    }
                                } else {
                                    commentsTab.style.transform = 'translateY(0)';
                                    commentsTab.classList.remove('keyboard-visible');
                                    
                                    // Show instructions again
                                    const instructions = document.querySelector('.instructions');
                                    if (instructions) {
                                        instructions.classList.remove('keyboard-hidden');
                                    }
                                }
                            }
                        } else {
                            // Keyboard hidden - reset position smoothly
                            const commentsTab = document.querySelector('.comments-tab.expanded');
                            if (commentsTab) {
                                commentsTab.style.transform = 'translateY(0)';
                                commentsTab.classList.remove('keyboard-visible');
                            }
                            
                            // Show instructions again
                            const instructions = document.querySelector('.instructions');
                            if (instructions) {
                                instructions.classList.remove('keyboard-hidden');
                            }
                        }
                    };
                    
                    window.visualViewport.addEventListener('resize', handleViewportChange);
                    handleViewportChange();
                    
                    // Clean up on blur
                    commentInput.addEventListener('blur', () => {
                        window.visualViewport.removeEventListener('resize', handleViewportChange);
                        const commentsTab = document.querySelector('.comments-tab.expanded');
                        if (commentsTab) {
                            commentsTab.style.transform = 'translateY(0)';
                            commentsTab.classList.remove('keyboard-visible');
                        }
                        
                        // Show instructions again
                        const instructions = document.querySelector('.instructions');
                        if (instructions) {
                            instructions.classList.remove('keyboard-hidden');
                        }
                    }, { once: true });
                } else {
                    // Fallback for older iOS - scroll input into view
                    setTimeout(() => {
                        commentInput.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }, 300);
                }
            });
        }

        // Close comments when clicking outside
        document.addEventListener('click', (e) => {
            if (!e.target.closest('.comments-tab') && !e.target.closest('.action-btn')) {
                const commentsTab = document.querySelector('.card-front .comments-tab');
                if (commentsTab) {
                    commentsTab.classList.remove('visible');
                }
            }
        });

        // Like button interaction (front card only)
        document.querySelectorAll('.card-front .action-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                e.stopPropagation();
                // Add visual feedback
                btn.style.transform = 'scale(0.9)';
                setTimeout(() => {
                    btn.style.transform = 'scale(1)';
                }, 100);
            });
        });

        // iOS Scroll Lock Management
        let scrollLocked = false;
        let savedScrollPosition = 0;

        function lockBodyScroll() {
            if (scrollLocked) return;
            
            // Save current scroll position
            savedScrollPosition = window.pageYOffset || document.documentElement.scrollTop;
            
            // Use overflow: hidden instead of position: fixed to allow nested scrolling
            // This approach works better on iOS for nested scrollable elements
            document.documentElement.classList.add('scroll-locked');
            document.body.classList.add('scroll-locked');
            
            // Set overflow hidden (not position fixed) to allow card content to scroll
            document.documentElement.style.overflow = 'hidden';
            document.documentElement.style.height = '100%';
            
            document.body.style.overflow = 'hidden';
            document.body.style.height = '100%';
            document.body.style.position = 'relative';
            
            scrollLocked = true;
        }

        function unlockBodyScroll() {
            if (!scrollLocked) return;
            
            // Remove scroll lock classes
            document.documentElement.classList.remove('scroll-locked');
            document.body.classList.remove('scroll-locked');
            
            // Remove explicit styles
            document.documentElement.style.removeProperty('overflow');
            document.documentElement.style.removeProperty('height');
            
            document.body.style.removeProperty('overflow');
            document.body.style.removeProperty('height');
            document.body.style.removeProperty('position');
            
            // Restore scroll position
            window.scrollTo(0, savedScrollPosition);
            
            scrollLocked = false;
        }

        // Prevent body scroll by default (for card container)
        document.body.style.overflow = 'hidden';

        // Action overlay functions
        function toggleActionOverlay(event) {
            event.stopPropagation();
            const overlay = document.getElementById('actionOverlay');
            const modal = document.getElementById('actionModal');
            const button = event.currentTarget;
            const card = document.getElementById('activityCard');

            // Get button and card positions
            const buttonRect = button.getBoundingClientRect();
            const cardRect = card.getBoundingClientRect();

            // Check if card is flipped
            const isFlipped = card.classList.contains('flipped');

            // Reset positioning styles
            modal.style.right = 'auto';
            modal.style.left = 'auto';
            modal.style.top = 'auto';

            if (isFlipped) {
                // For back of card: center horizontally, position in middle of card
                const leftPos = (cardRect.width - 240) / 2; // center modal (240px width)
                const topPos = (cardRect.height - 280) / 2; // center vertically (modal height ~280px)

                modal.style.left = leftPos + 'px';
                modal.style.top = topPos + 'px';
            } else {
                // For front of card: position to the left of button, vertically aligned
                const rightPos = cardRect.right - buttonRect.left + 8;
                const topPos = buttonRect.top - cardRect.top + buttonRect.height / 2 - 120;
                modal.style.right = rightPos + 'px';
                modal.style.top = topPos + 'px';
            }

            overlay.classList.toggle('visible');
        }

        function closeActionOverlay(event) {
            if (event.target === event.currentTarget) {
                const overlay = document.getElementById('actionOverlay');
                overlay.classList.remove('visible');
            }
        }

        function selectAction(action) {
            console.log('Selected action:', action);
            // In a real implementation, this would update the user's status with the show
            alert(`You selected: ${action.replace(/-/g, ' ')}`);

            // Close the overlay
            const overlay = document.getElementById('actionOverlay');
            overlay.classList.remove('visible');
        }

        // Close overlay when clicking outside
        document.addEventListener('click', (e) => {
            const overlay = document.getElementById('actionOverlay');
            if (overlay.classList.contains('visible') && !e.target.closest('.action-modal') && !e.target.closest('.action-btn')) {
                overlay.classList.remove('visible');
            }
        });

        // Comment like button interaction
        function toggleCommentLike(button, event) {
            // Prevent event from bubbling up and closing the comments bubble
            if (event) {
                event.stopPropagation();
                event.preventDefault();
            }
            
            button.classList.toggle('liked');
            const countSpan = button.querySelector('span');
            let count = parseInt(countSpan.textContent);

            if (button.classList.contains('liked')) {
                count++;
            } else {
                count--;
            }

            countSpan.textContent = count;

            // Add visual feedback
            button.style.transform = 'scale(0.9)';
            setTimeout(() => {
                button.style.transform = 'scale(1)';
            }, 100);
        }

        // User rating interaction
        function setUserRating(button, rating) {
            // Remove active class from all rating buttons
            document.querySelectorAll('.rating-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            // Add active class to clicked button
            button.classList.add('active');

            // Visual feedback
            button.style.transform = 'scale(0.95)';
            setTimeout(() => {
                button.style.transform = 'scale(1)';
            }, 100);

            // Log the rating (in production, this would save to database)
            console.log('User rated show as:', rating);
        }

        // iOS scroll management
        const card = document.getElementById('activityCard');
        const cardBackContent = document.querySelector('.card-back-content');
        
        if (card) {
            // Watch for card flip and manage scroll locking
            const observer = new MutationObserver((mutations) => {
                mutations.forEach((mutation) => {
                    if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
                        const isFlipped = card.classList.contains('flipped');
                        if (isFlipped) {
                            // Card flipped - lock body scroll
                            lockBodyScroll();
                        } else {
                            // Card unflipped - unlock body scroll
                            unlockBodyScroll();
                        }
                    }
                });
            });
            
            observer.observe(card, { attributes: true, attributeFilter: ['class'] });
            
            // Initial state check
            if (card.classList.contains('flipped')) {
                lockBodyScroll();
            }
        }
        
        // iOS scroll workaround - manually handle scrolling for transformed elements
        // This is necessary because iOS Safari has a bug where scrolling doesn't work
        // inside elements with CSS transforms (like our card flip)
        if (cardBackContent) {
            let touchStartY = 0;
            let touchStartScrollTop = 0;
            let lastTouchY = 0;
            let lastTouchTime = 0;
            let velocity = 0;
            let momentumAnimation = null;
            let isScrolling = false;
            
            // Smooth scroll with easing
            function smoothScrollTo(targetScrollTop) {
                const startScrollTop = cardBackContent.scrollTop;
                const distance = targetScrollTop - startScrollTop;
                const duration = Math.min(Math.abs(distance) * 0.5, 300); // Max 300ms
                const startTime = performance.now();
                
                function animate(currentTime) {
                    const elapsed = currentTime - startTime;
                    const progress = Math.min(elapsed / duration, 1);
                    
                    // Easing function (ease-out cubic)
                    const easeOutCubic = 1 - Math.pow(1 - progress, 3);
                    
                    const currentScrollTop = startScrollTop + (distance * easeOutCubic);
                    cardBackContent.scrollTop = currentScrollTop;
                    
                    if (progress < 1) {
                        momentumAnimation = requestAnimationFrame(animate);
                    } else {
                        momentumAnimation = null;
                    }
                }
                
                if (momentumAnimation) {
                    cancelAnimationFrame(momentumAnimation);
                }
                momentumAnimation = requestAnimationFrame(animate);
            }
            
            // Momentum scrolling after touch ends
            function applyMomentum() {
                if (Math.abs(velocity) < 0.1) {
                    velocity = 0;
                    return;
                }
                
                const maxScroll = cardBackContent.scrollHeight - cardBackContent.clientHeight;
                const currentScrollTop = cardBackContent.scrollTop;
                const friction = 0.92; // Deceleration factor - Apple-like smooth deceleration
                
                // Apply friction to velocity
                velocity *= friction;
                
                // Calculate new scroll position
                // Positive velocity = swiping down = scroll down (increase scrollTop)
                // Negative velocity = swiping up = scroll up (decrease scrollTop)
                let newScrollTop = currentScrollTop + velocity;
                
                // Stop at boundaries
                if (newScrollTop < 0) {
                    newScrollTop = 0;
                    velocity = 0;
                } else if (newScrollTop > maxScroll) {
                    newScrollTop = maxScroll;
                    velocity = 0;
                }
                
                cardBackContent.scrollTop = newScrollTop;
                
                // Continue momentum if velocity is still significant
                if (Math.abs(velocity) > 0.1) {
                    requestAnimationFrame(applyMomentum);
                } else {
                    velocity = 0;
                }
            }
            
            cardBackContent.addEventListener('touchstart', (e) => {
                if (!card.classList.contains('flipped')) return;
                
                // Cancel any ongoing momentum
                if (momentumAnimation) {
                    cancelAnimationFrame(momentumAnimation);
                    momentumAnimation = null;
                }
                velocity = 0;
                isScrolling = true;
                
                touchStartY = e.touches[0].clientY;
                touchStartScrollTop = cardBackContent.scrollTop;
                lastTouchY = touchStartY;
                lastTouchTime = performance.now();
            }, { passive: true });
            
            cardBackContent.addEventListener('touchmove', (e) => {
                if (!card.classList.contains('flipped')) return;
                
                const touchY = e.touches[0].clientY;
                const currentTime = performance.now();
                const deltaTime = currentTime - lastTouchTime;
                
                // Calculate velocity for momentum based on recent movement
                // Positive velocity = scrolling down (content moving up)
                if (deltaTime > 0 && lastTouchY !== 0) {
                    const deltaY = lastTouchY - touchY; // Positive when swiping down
                    velocity = (deltaY / deltaTime) * 16; // Normalize to 60fps, scale up for momentum
                }
                
                const deltaY = touchStartY - touchY;
                const newScrollTop = touchStartScrollTop + deltaY;
                const maxScroll = cardBackContent.scrollHeight - cardBackContent.clientHeight;
                
                // Manually set scroll position with rubber band effect at boundaries
                if (newScrollTop >= 0 && newScrollTop <= maxScroll) {
                    cardBackContent.scrollTop = newScrollTop;
                } else if (newScrollTop < 0) {
                    // Rubber band effect - reduce scroll amount when past boundary
                    const overscroll = Math.abs(newScrollTop);
                    cardBackContent.scrollTop = -overscroll * 0.3;
                } else if (newScrollTop > maxScroll) {
                    // Rubber band effect
                    const overscroll = newScrollTop - maxScroll;
                    cardBackContent.scrollTop = maxScroll + (overscroll * 0.3);
                }
                
                lastTouchY = touchY;
                lastTouchTime = currentTime;
            }, { passive: false });
            
            cardBackContent.addEventListener('touchend', () => {
                if (!card.classList.contains('flipped')) return;
                
                isScrolling = false;
                const maxScroll = cardBackContent.scrollHeight - cardBackContent.clientHeight;
                const currentScrollTop = cardBackContent.scrollTop;
                
                // Snap back if overscrolled
                if (currentScrollTop < 0) {
                    smoothScrollTo(0);
                    velocity = 0;
                } else if (currentScrollTop > maxScroll) {
                    smoothScrollTo(maxScroll);
                    velocity = 0;
                } else if (Math.abs(velocity) > 0.5) {
                    // Apply momentum scrolling - continue in the direction of the swipe
                    applyMomentum();
                } else {
                    velocity = 0;
                }
            }, { passive: true });
        }
        
        // iOS scroll handler for comments section (same technique as card back)
        const commentsFull = document.querySelector('.comments-full');
        if (commentsFull) {
            let touchStartY = 0;
            let touchStartScrollTop = 0;
            let lastTouchY = 0;
            let lastTouchTime = 0;
            let velocity = 0;
            let momentumAnimation = null;
            
            // Smooth scroll with easing
            function smoothScrollToComments(targetScrollTop) {
                const startScrollTop = commentsFull.scrollTop;
                const distance = targetScrollTop - startScrollTop;
                const duration = Math.min(Math.abs(distance) * 0.5, 300);
                const startTime = performance.now();
                
                function animate(currentTime) {
                    const elapsed = currentTime - startTime;
                    const progress = Math.min(elapsed / duration, 1);
                    const easeOutCubic = 1 - Math.pow(1 - progress, 3);
                    const currentScrollTop = startScrollTop + (distance * easeOutCubic);
                    commentsFull.scrollTop = currentScrollTop;
                    
                    if (progress < 1) {
                        momentumAnimation = requestAnimationFrame(animate);
                    } else {
                        momentumAnimation = null;
                    }
                }
                
                if (momentumAnimation) {
                    cancelAnimationFrame(momentumAnimation);
                }
                momentumAnimation = requestAnimationFrame(animate);
            }
            
            // Momentum scrolling after touch ends
            function applyMomentumComments() {
                if (Math.abs(velocity) < 0.1) {
                    velocity = 0;
                    return;
                }
                
                const maxScroll = commentsFull.scrollHeight - commentsFull.clientHeight;
                const currentScrollTop = commentsFull.scrollTop;
                const friction = 0.92; // Apple-like deceleration
                
                velocity *= friction;
                let newScrollTop = currentScrollTop + velocity;
                
                if (newScrollTop < 0) {
                    newScrollTop = 0;
                    velocity = 0;
                } else if (newScrollTop > maxScroll) {
                    newScrollTop = maxScroll;
                    velocity = 0;
                }
                
                commentsFull.scrollTop = newScrollTop;
                
                if (Math.abs(velocity) > 0.1) {
                    requestAnimationFrame(applyMomentumComments);
                } else {
                    velocity = 0;
                }
            }
            
            commentsFull.addEventListener('touchstart', (e) => {
                if (!document.querySelector('.comments-tab.expanded')) return;
                
                if (momentumAnimation) {
                    cancelAnimationFrame(momentumAnimation);
                    momentumAnimation = null;
                }
                velocity = 0;
                
                touchStartY = e.touches[0].clientY;
                touchStartScrollTop = commentsFull.scrollTop;
                lastTouchY = touchStartY;
                lastTouchTime = performance.now();
            }, { passive: true });
            
            commentsFull.addEventListener('touchmove', (e) => {
                if (!document.querySelector('.comments-tab.expanded')) return;
                
                // Prevent scroll from propagating to card container
                e.stopPropagation();
                
                const touchY = e.touches[0].clientY;
                const currentTime = performance.now();
                const deltaTime = currentTime - lastTouchTime;
                
                if (deltaTime > 0 && lastTouchY !== 0) {
                    const deltaY = lastTouchY - touchY;
                    velocity = (deltaY / deltaTime) * 16;
                }
                
                const deltaY = touchStartY - touchY;
                const newScrollTop = touchStartScrollTop + deltaY;
                const maxScroll = commentsFull.scrollHeight - commentsFull.clientHeight;
                
                if (newScrollTop >= 0 && newScrollTop <= maxScroll) {
                    commentsFull.scrollTop = newScrollTop;
                } else if (newScrollTop < 0) {
                    const overscroll = Math.abs(newScrollTop);
                    commentsFull.scrollTop = -overscroll * 0.3;
                } else if (newScrollTop > maxScroll) {
                    const overscroll = newScrollTop - maxScroll;
                    commentsFull.scrollTop = maxScroll + (overscroll * 0.3);
                }
                
                lastTouchY = touchY;
                lastTouchTime = currentTime;
            }, { passive: false });
            
            commentsFull.addEventListener('touchend', () => {
                if (!document.querySelector('.comments-tab.expanded')) return;
                
                const maxScroll = commentsFull.scrollHeight - commentsFull.clientHeight;
                const currentScrollTop = commentsFull.scrollTop;
                
                if (currentScrollTop < 0) {
                    smoothScrollToComments(0);
                    velocity = 0;
                } else if (currentScrollTop > maxScroll) {
                    smoothScrollToComments(maxScroll);
                    velocity = 0;
                } else if (Math.abs(velocity) > 0.5) {
                    applyMomentumComments();
                } else {
                    velocity = 0;
                }
            }, { passive: true });
        }
    </script>
</body>
</html>
